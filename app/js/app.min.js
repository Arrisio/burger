// Hamburger menu
const menuBtn = document.querySelector('.hamburger-menu-link'),
	hamMenu = document.getElementById('hamburger-menu'),
	hamList = document.getElementById('nav__list_hamburger'),
	body = document.querySelector('body');
hamListItems = document.querySelectorAll('.nav_hamburger .nav__item');


function аsleep(ms) {
	return new Promise(resolve => setTimeout(resolve, ms));
}

async function toggleMenu() {
	menuBtn.classList.toggle('is-active');
	hamMenu.classList.toggle('is-active');
	body.classList.toggle('is-locked');

	for (let hamListItem of hamListItems) {
		hamListItem.classList.toggle('is-active');
		await аsleep(100);

	};
};

menuBtn.addEventListener('click', e => {
	e.preventDefault();
	toggleMenu();
});
hamList.addEventListener('click', e => {
	let el = e.target;
	if (el.tagName == 'A') {
		toggleMenu();
	};
});


// Modal
modal = document.getElementById('modal');

function openModal(name = '', text = '', event = false) {
	(event ? event.preventDefault() : void(0)); // Если модалка открыта не по клику из из AJAX
	modal.classList.add('is-active');
	modal.querySelector('#modal__name').textContent = name;
	modal.querySelector('#modal__text').textContent = text;
	body.classList.add('is-locked');
}
$('.reviews__item .btn').on('click', (e) => {
	openModal(
		name = $(e.target).siblings(".reviews__title").text(),
		text = $(e.target).siblings(".reviews__text").text(),
		event = e
	);
});

// Закрытие Окна
$('.modal').on('click', (e) => {
	if (e.target == modal || e.target == modal.querySelector('.modal__close')) {
		e.preventDefault();
		modal.classList.remove('is-active');
		body.classList.remove('is-locked');
	}
})

//Закрытие модалки или меню на Esc
document.addEventListener("keydown", e => {
	if (e.keyCode == 27) { // закрываем габмургер меню
		if (hamMenu.classList.contains('is-active')) {
			toggleMenu();
		}

		if (modal.classList.contains('is-active')) { // закрываем модалку
			modal.classList.remove('is-active');
			body.classList.remove('is-locked');
		}
	}

});



// all Accordions
allAccordions = document.getElementsByClassName('accordion');

// Ищем ближайшего родителя переданного e.target ,
// у которого радитель - accordion
function findParentAccordItem(elt) {
	let i = 0; // защита от зациклавания
	while (
		!(elt.parentElement.classList.contains('accordion')) &&
		i < 100
	) {
		elt = elt.parentElement;
	}
	return elt;
}

for (let accordList of allAccordions) {
	accordList.addEventListener('click', e => {
		e.preventDefault();
		clickedAccordItem = findParentAccordItem(e.target);
		clickedAccordMenuItems = clickedAccordItem.parentElement.getElementsByTagName("LI");

		for (let accordItem of clickedAccordMenuItems) {
			if (accordItem == clickedAccordItem) {
				accordItem.classList.toggle('is-active');
			} else {
				accordItem.classList.remove('is-active');
			}
		}
	})
};


// Слайдер с Бургерами
slider = new Siema({
	selector: '.burgers__list',
	duration: 200,
	easing: 'ease-out',
	perPage: 1,
	startIndex: 0,
	draggable: true,
	multipleDrag: true,
	threshold: 20,
	loop: true,
	rtl: false,
	// onInit: () => {},
	// onChange: () => {},
});

sliderNextBtn = document.getElementById('burgers_slider-control--next');
sliderNextBtn.addEventListener('click', (e) => {
	e.preventDefault();
	slider.next()
});

sliderPrevBtn = document.getElementById('burgers_slider-control--prev');
sliderPrevBtn.addEventListener('click', (e) => {
	e.preventDefault();
	slider.prev()
});


// AJAX and Order Form
const orderForm = document.getElementById('order-form');


orderForm.addEventListener('submit', e => {
	e.preventDefault();
	const formData = new FormData(),
		URL = "https://webdev-api.loftschool.com/sendmail",
		xhr = new XMLHttpRequest();

	xhr.resposeType = 'json';
	xhr.open("POST", URL);
	xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");

	formData.append('name', orderForm.elements.customerName.value);
	formData.append('phone', orderForm.elements.phone.value);
	formData.append('comment', orderForm.elements.comment.value);
	formData.append('to', 'someemail@mail.ru');

	xhr.send(formData);
	xhr.onload = function () {
		let orderResponse = JSON.parse(xhr.responseText);
		if (orderResponse.status === 1 && xhr.status < 400) { //status 0 fail send
			openModal(name = 'Сообщение', text = orderResponse.message);; //status 1 success send
			orderForm.reset();
		} else {
			openModal(name = 'Ошибка', text = orderResponse.message);
		};
	}
});

// Burgers - скрыть.показать ингредиенты
// let ingredientsVisibility = () => {
$(".ingredients").on({
	// click: e => {
	// 	e.preventDefault();
	// 	$(e.currentTarget).toggleClass('is-active');
	// },
	mouseenter: e => {
		$(e.currentTarget).toggleClass('is-active');
	},
	mouseleave: e => {
		$(e.currentTarget).removeClass('is-active');
	}
})

// };
// Скопипащено с официальной документации
// if (false) {

ymaps.ready(function () {
	var myMap = new ymaps.Map('map', {
			center: [59.93, 30.33],
			zoom: 12
		}, {
			searchControlProvider: 'yandex#search'
		}),
		clusterer = new ymaps.Clusterer({
			// Зададим массив, описывающий иконки кластеров разного размера.
			clusterIcons: [{
					href: './img/contacts/map-marker.png',
					size: [46, 58],
					offset: [-23, -29]
				},
				{
					href: './img/contacts/map-marker.png',
					size: [46, 58],
					offset: [-23, -29]
				}
			],
			// Эта опция отвечает за размеры кластеров.
			// В данном случае для кластеров, содержащих до 100 элементов,
			// будет показываться маленькая иконка. Для остальных - большая.
			clusterNumbers: [8],
			clusterIconContentLayout: null
		}),
		getPointData = function (index) {
			return {
				balloonContentBody: 'тошниловка <strong>№' + index + '</strong>',
				// clusterCaption: 'метка <strong>' + index + '</strong>',
			};
		},
		points = [
			[59.9, 30.3],
			[59.95, 30.43],
			[59.97, 30.35],

		],
		geoObjects = [];

	for (var i = 0, len = points.length; i < len; i++) {
		geoObjects[i] = new ymaps.Placemark(points[i], getPointData(i), {
			iconLayout: 'default#imageWithContent',
			iconImageHref: './img/contacts/map-marker.png',
			iconImageSize: [46, 58],
			iconImageOffset: [-23, -29]
		});
	}

	clusterer.add(geoObjects);
	myMap.geoObjects.add(clusterer);

	myMap.setBounds(clusterer.getBounds(), {
		checkZoomRange: true
	});
});
// }
var initOps = (() => {
	ops = {};
	ops.model = (() => {
		var currentPosition = 0,
			flagBlocked = false;;
		const minPosition = 0,
			maxPosition = $('.section').length - 1,
			blockDuration = 300;

		moveTo = ((newPosition) => {
			isLastPosition = (newPosition === maxPosition);
			if (newPosition != currentPosition) {
				ops.view.goToSection(newPosition, isLastPosition);
				currentPosition = newPosition;
			}
		})
		moveOn = ((deltaY) => {

			if (!flagBlocked) {
				flagBlocked = true;
				let newPosition = Math.max(
					Math.min((currentPosition + deltaY), maxPosition),
					minPosition
				)
				moveTo(newPosition);
				setTimeout(() => {
					flagBlocked = false;
				}, blockDuration)
			}
		})

		moveDown = function () {
			currentPosition < maxPosition ? ops.model.moveOn(1) : ops.model.moveTo(0);
		}
		return {
			moveTo,
			moveOn,
			moveDown
		}
	})()

	ops.view = (() => {
		opsContainer = $('.ops__container');
		downButton = $('.down-btn');
		opsSliderItems = $('.ops-slider__item');

		goToSection = ((position, isLastPosition = false) => {
			translatePropery = `translateY(${-position * 100}vh)`;
			opsContainer.css({
				transform: translatePropery
			});
			opsSliderItems.removeClass('is-active');
			opsSliderItems.eq(position).addClass('is-active');
			if (isLastPosition) {
				downButton.css('transform', "rotate(180deg)")
			} else {
				downButton.css('transform', "rotate(0deg)")
			}
		})
		return {
			goToSection
		}
	})();

	ops.controll = (() => {
		$('.ops').on('wheel', e => {
			e.preventDefault();
			if (e.originalEvent.deltaY > 0) {
				ops.model.moveOn(1)
			} else if (e.originalEvent.deltaY < 0) {
				ops.model.moveOn(-1)
			}
		});
		$('.down-btn').on('click', e => {
			e.preventDefault();
			ops.model.moveDown();
		});
		$('.ops-slider li').on('click', function (e) {
			e.preventDefault();
			ops.model.moveTo($(this).index());
		})
		$('.nav__item').on('click', function (e) {
			e.preventDefault();
			//$(this).index() - номер слайдера(т.е. секции) на который ткнули
			ops.model.moveTo($(this).index());
		})
		$(document).on({
			'keydown': e => {
				// кнопки вверх и вниз
				switch (e.keyCode) {
					case 40:
						ops.model.moveOn(1);
						break;
					case 38:
						ops.model.moveOn(-1);
						break;
				}
			}
		})

		$(document).swipe({
			swipe: function (event, direction, distance, duration, fingerCount) {
				console.log(distance, duration);
				if (direction === 'up') {
					ops.model.moveOn(1);
				} else if (direction === 'down') {
					ops.model.moveOn(-1);
				}
			},
			fingers: 'all'
		});

	})()
});


initOps();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsIm1hcC5qcyIsIm9wcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gSGFtYnVyZ2VyIG1lbnVcclxuY29uc3QgbWVudUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oYW1idXJnZXItbWVudS1saW5rJyksXHJcblx0aGFtTWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYW1idXJnZXItbWVudScpLFxyXG5cdGhhbUxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmF2X19saXN0X2hhbWJ1cmdlcicpLFxyXG5cdGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbmhhbUxpc3RJdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5uYXZfaGFtYnVyZ2VyIC5uYXZfX2l0ZW0nKTtcclxuXHJcblxyXG5mdW5jdGlvbiDQsHNsZWVwKG1zKSB7XHJcblx0cmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiB0b2dnbGVNZW51KCkge1xyXG5cdG1lbnVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcblx0aGFtTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuXHRib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2lzLWxvY2tlZCcpO1xyXG5cclxuXHRmb3IgKGxldCBoYW1MaXN0SXRlbSBvZiBoYW1MaXN0SXRlbXMpIHtcclxuXHRcdGhhbUxpc3RJdGVtLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG5cdFx0YXdhaXQg0LBzbGVlcCgxMDApO1xyXG5cclxuXHR9O1xyXG59O1xyXG5cclxubWVudUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdGUucHJldmVudERlZmF1bHQoKTtcclxuXHR0b2dnbGVNZW51KCk7XHJcbn0pO1xyXG5oYW1MaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0bGV0IGVsID0gZS50YXJnZXQ7XHJcblx0aWYgKGVsLnRhZ05hbWUgPT0gJ0EnKSB7XHJcblx0XHR0b2dnbGVNZW51KCk7XHJcblx0fTtcclxufSk7XHJcblxyXG5cclxuLy8gTW9kYWxcclxubW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwnKTtcclxuXHJcbmZ1bmN0aW9uIG9wZW5Nb2RhbChuYW1lID0gJycsIHRleHQgPSAnJywgZXZlbnQgPSBmYWxzZSkge1xyXG5cdChldmVudCA/IGV2ZW50LnByZXZlbnREZWZhdWx0KCkgOiB2b2lkKDApKTsgLy8g0JXRgdC70Lgg0LzQvtC00LDQu9C60LAg0L7RgtC60YDRi9GC0LAg0L3QtSDQv9C+INC60LvQuNC60YMg0LjQtyDQuNC3IEFKQVhcclxuXHRtb2RhbC5jbGFzc0xpc3QuYWRkKCdpcy1hY3RpdmUnKTtcclxuXHRtb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWxfX25hbWUnKS50ZXh0Q29udGVudCA9IG5hbWU7XHJcblx0bW9kYWwucXVlcnlTZWxlY3RvcignI21vZGFsX190ZXh0JykudGV4dENvbnRlbnQgPSB0ZXh0O1xyXG5cdGJvZHkuY2xhc3NMaXN0LmFkZCgnaXMtbG9ja2VkJyk7XHJcbn1cclxuJCgnLnJldmlld3NfX2l0ZW0gLmJ0bicpLm9uKCdjbGljaycsIChlKSA9PiB7XHJcblx0b3Blbk1vZGFsKFxyXG5cdFx0bmFtZSA9ICQoZS50YXJnZXQpLnNpYmxpbmdzKFwiLnJldmlld3NfX3RpdGxlXCIpLnRleHQoKSxcclxuXHRcdHRleHQgPSAkKGUudGFyZ2V0KS5zaWJsaW5ncyhcIi5yZXZpZXdzX190ZXh0XCIpLnRleHQoKSxcclxuXHRcdGV2ZW50ID0gZVxyXG5cdCk7XHJcbn0pO1xyXG5cclxuLy8g0JfQsNC60YDRi9GC0LjQtSDQntC60L3QsFxyXG4kKCcubW9kYWwnKS5vbignY2xpY2snLCAoZSkgPT4ge1xyXG5cdGlmIChlLnRhcmdldCA9PSBtb2RhbCB8fCBlLnRhcmdldCA9PSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJykpIHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWFjdGl2ZScpO1xyXG5cdFx0Ym9keS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1sb2NrZWQnKTtcclxuXHR9XHJcbn0pXHJcblxyXG4vL9CX0LDQutGA0YvRgtC40LUg0LzQvtC00LDQu9C60Lgg0LjQu9C4INC80LXQvdGOINC90LAgRXNjXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGUgPT4ge1xyXG5cdGlmIChlLmtleUNvZGUgPT0gMjcpIHsgLy8g0LfQsNC60YDRi9Cy0LDQtdC8INCz0LDQsdC80YPRgNCz0LXRgCDQvNC10L3RjlxyXG5cdFx0aWYgKGhhbU1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1hY3RpdmUnKSkge1xyXG5cdFx0XHR0b2dnbGVNZW51KCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKG1vZGFsLmNsYXNzTGlzdC5jb250YWlucygnaXMtYWN0aXZlJykpIHsgLy8g0LfQsNC60YDRi9Cy0LDQtdC8INC80L7QtNCw0LvQutGDXHJcblx0XHRcdG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWFjdGl2ZScpO1xyXG5cdFx0XHRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWxvY2tlZCcpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcbn0pO1xyXG5cclxuXHJcblxyXG4vLyBhbGwgQWNjb3JkaW9uc1xyXG5hbGxBY2NvcmRpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYWNjb3JkaW9uJyk7XHJcblxyXG4vLyDQmNGJ0LXQvCDQsdC70LjQttCw0LnRiNC10LPQviDRgNC+0LTQuNGC0LXQu9GPINC/0LXRgNC10LTQsNC90L3QvtCz0L4gZS50YXJnZXQgLFxyXG4vLyDRgyDQutC+0YLQvtGA0L7Qs9C+INGA0LDQtNC40YLQtdC70YwgLSBhY2NvcmRpb25cclxuZnVuY3Rpb24gZmluZFBhcmVudEFjY29yZEl0ZW0oZWx0KSB7XHJcblx0bGV0IGkgPSAwOyAvLyDQt9Cw0YnQuNGC0LAg0L7RgiDQt9Cw0YbQuNC60LvQsNCy0LDQvdC40Y9cclxuXHR3aGlsZSAoXHJcblx0XHQhKGVsdC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnYWNjb3JkaW9uJykpICYmXHJcblx0XHRpIDwgMTAwXHJcblx0KSB7XHJcblx0XHRlbHQgPSBlbHQucGFyZW50RWxlbWVudDtcclxuXHR9XHJcblx0cmV0dXJuIGVsdDtcclxufVxyXG5cclxuZm9yIChsZXQgYWNjb3JkTGlzdCBvZiBhbGxBY2NvcmRpb25zKSB7XHJcblx0YWNjb3JkTGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0Y2xpY2tlZEFjY29yZEl0ZW0gPSBmaW5kUGFyZW50QWNjb3JkSXRlbShlLnRhcmdldCk7XHJcblx0XHRjbGlja2VkQWNjb3JkTWVudUl0ZW1zID0gY2xpY2tlZEFjY29yZEl0ZW0ucGFyZW50RWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIkxJXCIpO1xyXG5cclxuXHRcdGZvciAobGV0IGFjY29yZEl0ZW0gb2YgY2xpY2tlZEFjY29yZE1lbnVJdGVtcykge1xyXG5cdFx0XHRpZiAoYWNjb3JkSXRlbSA9PSBjbGlja2VkQWNjb3JkSXRlbSkge1xyXG5cdFx0XHRcdGFjY29yZEl0ZW0uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0YWNjb3JkSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pXHJcbn07XHJcblxyXG5cclxuLy8g0KHQu9Cw0LnQtNC10YAg0YEg0JHRg9GA0LPQtdGA0LDQvNC4XHJcbnNsaWRlciA9IG5ldyBTaWVtYSh7XHJcblx0c2VsZWN0b3I6ICcuYnVyZ2Vyc19fbGlzdCcsXHJcblx0ZHVyYXRpb246IDIwMCxcclxuXHRlYXNpbmc6ICdlYXNlLW91dCcsXHJcblx0cGVyUGFnZTogMSxcclxuXHRzdGFydEluZGV4OiAwLFxyXG5cdGRyYWdnYWJsZTogdHJ1ZSxcclxuXHRtdWx0aXBsZURyYWc6IHRydWUsXHJcblx0dGhyZXNob2xkOiAyMCxcclxuXHRsb29wOiB0cnVlLFxyXG5cdHJ0bDogZmFsc2UsXHJcblx0Ly8gb25Jbml0OiAoKSA9PiB7fSxcclxuXHQvLyBvbkNoYW5nZTogKCkgPT4ge30sXHJcbn0pO1xyXG5cclxuc2xpZGVyTmV4dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXJnZXJzX3NsaWRlci1jb250cm9sLS1uZXh0Jyk7XHJcbnNsaWRlck5leHRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG5cdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRzbGlkZXIubmV4dCgpXHJcbn0pO1xyXG5cclxuc2xpZGVyUHJldkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXJnZXJzX3NsaWRlci1jb250cm9sLS1wcmV2Jyk7XHJcbnNsaWRlclByZXZCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG5cdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRzbGlkZXIucHJldigpXHJcbn0pO1xyXG5cclxuXHJcbi8vIEFKQVggYW5kIE9yZGVyIEZvcm1cclxuY29uc3Qgb3JkZXJGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29yZGVyLWZvcm0nKTtcclxuXHJcblxyXG5vcmRlckZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZSA9PiB7XHJcblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCksXHJcblx0XHRVUkwgPSBcImh0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbFwiLFxyXG5cdFx0eGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcblxyXG5cdHhoci5yZXNwb3NlVHlwZSA9ICdqc29uJztcclxuXHR4aHIub3BlbihcIlBPU1RcIiwgVVJMKTtcclxuXHR4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcclxuXHJcblx0Zm9ybURhdGEuYXBwZW5kKCduYW1lJywgb3JkZXJGb3JtLmVsZW1lbnRzLmN1c3RvbWVyTmFtZS52YWx1ZSk7XHJcblx0Zm9ybURhdGEuYXBwZW5kKCdwaG9uZScsIG9yZGVyRm9ybS5lbGVtZW50cy5waG9uZS52YWx1ZSk7XHJcblx0Zm9ybURhdGEuYXBwZW5kKCdjb21tZW50Jywgb3JkZXJGb3JtLmVsZW1lbnRzLmNvbW1lbnQudmFsdWUpO1xyXG5cdGZvcm1EYXRhLmFwcGVuZCgndG8nLCAnc29tZWVtYWlsQG1haWwucnUnKTtcclxuXHJcblx0eGhyLnNlbmQoZm9ybURhdGEpO1xyXG5cdHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRsZXQgb3JkZXJSZXNwb25zZSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XHJcblx0XHRpZiAob3JkZXJSZXNwb25zZS5zdGF0dXMgPT09IDEgJiYgeGhyLnN0YXR1cyA8IDQwMCkgeyAvL3N0YXR1cyAwIGZhaWwgc2VuZFxyXG5cdFx0XHRvcGVuTW9kYWwobmFtZSA9ICfQodC+0L7QsdGJ0LXQvdC40LUnLCB0ZXh0ID0gb3JkZXJSZXNwb25zZS5tZXNzYWdlKTs7IC8vc3RhdHVzIDEgc3VjY2VzcyBzZW5kXHJcblx0XHRcdG9yZGVyRm9ybS5yZXNldCgpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0b3Blbk1vZGFsKG5hbWUgPSAn0J7RiNC40LHQutCwJywgdGV4dCA9IG9yZGVyUmVzcG9uc2UubWVzc2FnZSk7XHJcblx0XHR9O1xyXG5cdH1cclxufSk7XHJcblxyXG4vLyBCdXJnZXJzIC0g0YHQutGA0YvRgtGMLtC/0L7QutCw0LfQsNGC0Ywg0LjQvdCz0YDQtdC00LjQtdC90YLRi1xyXG4vLyBsZXQgaW5ncmVkaWVudHNWaXNpYmlsaXR5ID0gKCkgPT4ge1xyXG4kKFwiLmluZ3JlZGllbnRzXCIpLm9uKHtcclxuXHQvLyBjbGljazogZSA9PiB7XHJcblx0Ly8gXHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0Ly8gXHQkKGUuY3VycmVudFRhcmdldCkudG9nZ2xlQ2xhc3MoJ2lzLWFjdGl2ZScpO1xyXG5cdC8vIH0sXHJcblx0bW91c2VlbnRlcjogZSA9PiB7XHJcblx0XHQkKGUuY3VycmVudFRhcmdldCkudG9nZ2xlQ2xhc3MoJ2lzLWFjdGl2ZScpO1xyXG5cdH0sXHJcblx0bW91c2VsZWF2ZTogZSA9PiB7XHJcblx0XHQkKGUuY3VycmVudFRhcmdldCkucmVtb3ZlQ2xhc3MoJ2lzLWFjdGl2ZScpO1xyXG5cdH1cclxufSlcclxuXHJcbi8vIH07IiwiLy8g0KHQutC+0L/QuNC/0LDRidC10L3QviDRgSDQvtGE0LjRhtC40LDQu9GM0L3QvtC5INC00L7QutGD0LzQtdC90YLQsNGG0LjQuFxyXG4vLyBpZiAoZmFsc2UpIHtcclxuXHJcbnltYXBzLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuXHR2YXIgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKCdtYXAnLCB7XHJcblx0XHRcdGNlbnRlcjogWzU5LjkzLCAzMC4zM10sXHJcblx0XHRcdHpvb206IDEyXHJcblx0XHR9LCB7XHJcblx0XHRcdHNlYXJjaENvbnRyb2xQcm92aWRlcjogJ3lhbmRleCNzZWFyY2gnXHJcblx0XHR9KSxcclxuXHRcdGNsdXN0ZXJlciA9IG5ldyB5bWFwcy5DbHVzdGVyZXIoe1xyXG5cdFx0XHQvLyDQl9Cw0LTQsNC00LjQvCDQvNCw0YHRgdC40LIsINC+0L/QuNGB0YvQstCw0Y7RidC40Lkg0LjQutC+0L3QutC4INC60LvQsNGB0YLQtdGA0L7QsiDRgNCw0LfQvdC+0LPQviDRgNCw0LfQvNC10YDQsC5cclxuXHRcdFx0Y2x1c3Rlckljb25zOiBbe1xyXG5cdFx0XHRcdFx0aHJlZjogJy4vaW1nL2NvbnRhY3RzL21hcC1tYXJrZXIucG5nJyxcclxuXHRcdFx0XHRcdHNpemU6IFs0NiwgNThdLFxyXG5cdFx0XHRcdFx0b2Zmc2V0OiBbLTIzLCAtMjldXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHR7XHJcblx0XHRcdFx0XHRocmVmOiAnLi9pbWcvY29udGFjdHMvbWFwLW1hcmtlci5wbmcnLFxyXG5cdFx0XHRcdFx0c2l6ZTogWzQ2LCA1OF0sXHJcblx0XHRcdFx0XHRvZmZzZXQ6IFstMjMsIC0yOV1cclxuXHRcdFx0XHR9XHJcblx0XHRcdF0sXHJcblx0XHRcdC8vINCt0YLQsCDQvtC/0YbQuNGPINC+0YLQstC10YfQsNC10YIg0LfQsCDRgNCw0LfQvNC10YDRiyDQutC70LDRgdGC0LXRgNC+0LIuXHJcblx0XHRcdC8vINCSINC00LDQvdC90L7QvCDRgdC70YPRh9Cw0LUg0LTQu9GPINC60LvQsNGB0YLQtdGA0L7Qsiwg0YHQvtC00LXRgNC20LDRidC40YUg0LTQviAxMDAg0Y3Qu9C10LzQtdC90YLQvtCyLFxyXG5cdFx0XHQvLyDQsdGD0LTQtdGCINC/0L7QutCw0LfRi9Cy0LDRgtGM0YHRjyDQvNCw0LvQtdC90YzQutCw0Y8g0LjQutC+0L3QutCwLiDQlNC70Y8g0L7RgdGC0LDQu9GM0L3Ri9GFIC0g0LHQvtC70YzRiNCw0Y8uXHJcblx0XHRcdGNsdXN0ZXJOdW1iZXJzOiBbOF0sXHJcblx0XHRcdGNsdXN0ZXJJY29uQ29udGVudExheW91dDogbnVsbFxyXG5cdFx0fSksXHJcblx0XHRnZXRQb2ludERhdGEgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuXHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRiYWxsb29uQ29udGVudEJvZHk6ICfRgtC+0YjQvdC40LvQvtCy0LrQsCA8c3Ryb25nPuKElicgKyBpbmRleCArICc8L3N0cm9uZz4nLFxyXG5cdFx0XHRcdC8vIGNsdXN0ZXJDYXB0aW9uOiAn0LzQtdGC0LrQsCA8c3Ryb25nPicgKyBpbmRleCArICc8L3N0cm9uZz4nLFxyXG5cdFx0XHR9O1xyXG5cdFx0fSxcclxuXHRcdHBvaW50cyA9IFtcclxuXHRcdFx0WzU5LjksIDMwLjNdLFxyXG5cdFx0XHRbNTkuOTUsIDMwLjQzXSxcclxuXHRcdFx0WzU5Ljk3LCAzMC4zNV0sXHJcblxyXG5cdFx0XSxcclxuXHRcdGdlb09iamVjdHMgPSBbXTtcclxuXHJcblx0Zm9yICh2YXIgaSA9IDAsIGxlbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0Z2VvT2JqZWN0c1tpXSA9IG5ldyB5bWFwcy5QbGFjZW1hcmsocG9pbnRzW2ldLCBnZXRQb2ludERhdGEoaSksIHtcclxuXHRcdFx0aWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2VXaXRoQ29udGVudCcsXHJcblx0XHRcdGljb25JbWFnZUhyZWY6ICcuL2ltZy9jb250YWN0cy9tYXAtbWFya2VyLnBuZycsXHJcblx0XHRcdGljb25JbWFnZVNpemU6IFs0NiwgNThdLFxyXG5cdFx0XHRpY29uSW1hZ2VPZmZzZXQ6IFstMjMsIC0yOV1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0Y2x1c3RlcmVyLmFkZChnZW9PYmplY3RzKTtcclxuXHRteU1hcC5nZW9PYmplY3RzLmFkZChjbHVzdGVyZXIpO1xyXG5cclxuXHRteU1hcC5zZXRCb3VuZHMoY2x1c3RlcmVyLmdldEJvdW5kcygpLCB7XHJcblx0XHRjaGVja1pvb21SYW5nZTogdHJ1ZVxyXG5cdH0pO1xyXG59KTtcclxuLy8gfSIsInZhciBpbml0T3BzID0gKCgpID0+IHtcclxuXHRvcHMgPSB7fTtcclxuXHRvcHMubW9kZWwgPSAoKCkgPT4ge1xyXG5cdFx0dmFyIGN1cnJlbnRQb3NpdGlvbiA9IDAsXHJcblx0XHRcdGZsYWdCbG9ja2VkID0gZmFsc2U7O1xyXG5cdFx0Y29uc3QgbWluUG9zaXRpb24gPSAwLFxyXG5cdFx0XHRtYXhQb3NpdGlvbiA9ICQoJy5zZWN0aW9uJykubGVuZ3RoIC0gMSxcclxuXHRcdFx0YmxvY2tEdXJhdGlvbiA9IDMwMDtcclxuXHJcblx0XHRtb3ZlVG8gPSAoKG5ld1Bvc2l0aW9uKSA9PiB7XHJcblx0XHRcdGlzTGFzdFBvc2l0aW9uID0gKG5ld1Bvc2l0aW9uID09PSBtYXhQb3NpdGlvbik7XHJcblx0XHRcdGlmIChuZXdQb3NpdGlvbiAhPSBjdXJyZW50UG9zaXRpb24pIHtcclxuXHRcdFx0XHRvcHMudmlldy5nb1RvU2VjdGlvbihuZXdQb3NpdGlvbiwgaXNMYXN0UG9zaXRpb24pO1xyXG5cdFx0XHRcdGN1cnJlbnRQb3NpdGlvbiA9IG5ld1Bvc2l0aW9uO1xyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cdFx0bW92ZU9uID0gKChkZWx0YVkpID0+IHtcclxuXHJcblx0XHRcdGlmICghZmxhZ0Jsb2NrZWQpIHtcclxuXHRcdFx0XHRmbGFnQmxvY2tlZCA9IHRydWU7XHJcblx0XHRcdFx0bGV0IG5ld1Bvc2l0aW9uID0gTWF0aC5tYXgoXHJcblx0XHRcdFx0XHRNYXRoLm1pbigoY3VycmVudFBvc2l0aW9uICsgZGVsdGFZKSwgbWF4UG9zaXRpb24pLFxyXG5cdFx0XHRcdFx0bWluUG9zaXRpb25cclxuXHRcdFx0XHQpXHJcblx0XHRcdFx0bW92ZVRvKG5ld1Bvc2l0aW9uKTtcclxuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdFx0XHRcdGZsYWdCbG9ja2VkID0gZmFsc2U7XHJcblx0XHRcdFx0fSwgYmxvY2tEdXJhdGlvbilcclxuXHRcdFx0fVxyXG5cdFx0fSlcclxuXHJcblx0XHRtb3ZlRG93biA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Y3VycmVudFBvc2l0aW9uIDwgbWF4UG9zaXRpb24gPyBvcHMubW9kZWwubW92ZU9uKDEpIDogb3BzLm1vZGVsLm1vdmVUbygwKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdG1vdmVUbyxcclxuXHRcdFx0bW92ZU9uLFxyXG5cdFx0XHRtb3ZlRG93blxyXG5cdFx0fVxyXG5cdH0pKClcclxuXHJcblx0b3BzLnZpZXcgPSAoKCkgPT4ge1xyXG5cdFx0b3BzQ29udGFpbmVyID0gJCgnLm9wc19fY29udGFpbmVyJyk7XHJcblx0XHRkb3duQnV0dG9uID0gJCgnLmRvd24tYnRuJyk7XHJcblx0XHRvcHNTbGlkZXJJdGVtcyA9ICQoJy5vcHMtc2xpZGVyX19pdGVtJyk7XHJcblxyXG5cdFx0Z29Ub1NlY3Rpb24gPSAoKHBvc2l0aW9uLCBpc0xhc3RQb3NpdGlvbiA9IGZhbHNlKSA9PiB7XHJcblx0XHRcdHRyYW5zbGF0ZVByb3BlcnkgPSBgdHJhbnNsYXRlWSgkey1wb3NpdGlvbiAqIDEwMH12aClgO1xyXG5cdFx0XHRvcHNDb250YWluZXIuY3NzKHtcclxuXHRcdFx0XHR0cmFuc2Zvcm06IHRyYW5zbGF0ZVByb3BlcnlcclxuXHRcdFx0fSk7XHJcblx0XHRcdG9wc1NsaWRlckl0ZW1zLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTtcclxuXHRcdFx0b3BzU2xpZGVySXRlbXMuZXEocG9zaXRpb24pLmFkZENsYXNzKCdpcy1hY3RpdmUnKTtcclxuXHRcdFx0aWYgKGlzTGFzdFBvc2l0aW9uKSB7XHJcblx0XHRcdFx0ZG93bkJ1dHRvbi5jc3MoJ3RyYW5zZm9ybScsIFwicm90YXRlKDE4MGRlZylcIilcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRkb3duQnV0dG9uLmNzcygndHJhbnNmb3JtJywgXCJyb3RhdGUoMGRlZylcIilcclxuXHRcdFx0fVxyXG5cdFx0fSlcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGdvVG9TZWN0aW9uXHJcblx0XHR9XHJcblx0fSkoKTtcclxuXHJcblx0b3BzLmNvbnRyb2xsID0gKCgpID0+IHtcclxuXHRcdCQoJy5vcHMnKS5vbignd2hlZWwnLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRpZiAoZS5vcmlnaW5hbEV2ZW50LmRlbHRhWSA+IDApIHtcclxuXHRcdFx0XHRvcHMubW9kZWwubW92ZU9uKDEpXHJcblx0XHRcdH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50LmRlbHRhWSA8IDApIHtcclxuXHRcdFx0XHRvcHMubW9kZWwubW92ZU9uKC0xKVxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdCQoJy5kb3duLWJ0bicpLm9uKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdG9wcy5tb2RlbC5tb3ZlRG93bigpO1xyXG5cdFx0fSk7XHJcblx0XHQkKCcub3BzLXNsaWRlciBsaScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0b3BzLm1vZGVsLm1vdmVUbygkKHRoaXMpLmluZGV4KCkpO1xyXG5cdFx0fSlcclxuXHRcdCQoJy5uYXZfX2l0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdC8vJCh0aGlzKS5pbmRleCgpIC0g0L3QvtC80LXRgCDRgdC70LDQudC00LXRgNCwKNGCLtC1LiDRgdC10LrRhtC40LgpINC90LAg0LrQvtGC0L7RgNGL0Lkg0YLQutC90YPQu9C4XHJcblx0XHRcdG9wcy5tb2RlbC5tb3ZlVG8oJCh0aGlzKS5pbmRleCgpKTtcclxuXHRcdH0pXHJcblx0XHQkKGRvY3VtZW50KS5vbih7XHJcblx0XHRcdCdrZXlkb3duJzogZSA9PiB7XHJcblx0XHRcdFx0Ly8g0LrQvdC+0L/QutC4INCy0LLQtdGA0YUg0Lgg0LLQvdC40LdcclxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG5cdFx0XHRcdFx0Y2FzZSA0MDpcclxuXHRcdFx0XHRcdFx0b3BzLm1vZGVsLm1vdmVPbigxKTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRjYXNlIDM4OlxyXG5cdFx0XHRcdFx0XHRvcHMubW9kZWwubW92ZU9uKC0xKTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cclxuXHRcdCQoZG9jdW1lbnQpLnN3aXBlKHtcclxuXHRcdFx0c3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uLCBkaXN0YW5jZSwgZHVyYXRpb24sIGZpbmdlckNvdW50KSB7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coZGlzdGFuY2UsIGR1cmF0aW9uKTtcclxuXHRcdFx0XHRpZiAoZGlyZWN0aW9uID09PSAndXAnKSB7XHJcblx0XHRcdFx0XHRvcHMubW9kZWwubW92ZU9uKDEpO1xyXG5cdFx0XHRcdH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnZG93bicpIHtcclxuXHRcdFx0XHRcdG9wcy5tb2RlbC5tb3ZlT24oLTEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHRcdFx0ZmluZ2VyczogJ2FsbCdcclxuXHRcdH0pO1xyXG5cclxuXHR9KSgpXHJcbn0pO1xyXG5cclxuXHJcbmluaXRPcHMoKTsiXX0=
