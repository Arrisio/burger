// Hamburger menu
const menuBtn = document.querySelector('.hamburger-menu-link'),
	hamMenu = document.getElementById('hamburger-menu'),
	hamList = document.getElementById('nav__list_hamburger'),
	body = document.querySelector('body');
hamListItems = document.querySelectorAll('.nav_hamburger .nav__item');


function аsleep(ms) {
	return new Promise(resolve => setTimeout(resolve, ms));
}

async function toggleMenu() {
	menuBtn.classList.toggle('is-active');
	hamMenu.classList.toggle('is-active');
	body.classList.toggle('is-locked');

	for (let hamListItem of hamListItems) {
		hamListItem.classList.toggle('is-active');
		await аsleep(100);

	};
};

menuBtn.addEventListener('click', e => {
	e.preventDefault();
	toggleMenu();
});
hamList.addEventListener('click', e => {
	let el = e.target;
	if (el.tagName == 'A') {
		toggleMenu();
	};
});


// Modal
modal = document.getElementById('modal');

function openModal(name = '', text = '', event = false) {
	(event ? event.preventDefault() : void(0)); // Если модалка открыта не по клику из из AJAX
	modal.classList.add('is-active');
	modal.querySelector('#modal__name').textContent = name;
	modal.querySelector('#modal__text').textContent = text;
	body.classList.add('is-locked');
}
$('.reviews__item .btn').on('click', (e) => {
	openModal(
		name = $(e.target).siblings(".reviews__title").text(),
		text = $(e.target).siblings(".reviews__text").text(),
		event = e
	);
});

// Закрытие Окна
$('.modal').on('click', (e) => {
	if (e.target == modal || e.target == modal.querySelector('.modal__close')) {
		e.preventDefault();
		modal.classList.remove('is-active');
		body.classList.remove('is-locked');
	}
})

//Закрытие модалки или меню на Esc
document.addEventListener("keydown", e => {
	if (e.keyCode == 27) { // закрываем габмургер меню
		if (hamMenu.classList.contains('is-active')) {
			toggleMenu();
		}

		if (modal.classList.contains('is-active')) { // закрываем модалку
			modal.classList.remove('is-active');
			body.classList.remove('is-locked');
		}
	}

});



// all Accordions
allAccordions = document.getElementsByClassName('accordion');

// Ищем ближайшего родителя переданного e.target ,
// у которого радитель - accordion
function findParentAccordItem(elt) {
	let i = 0; // защита от зациклавания
	while (
		!(elt.parentElement.classList.contains('accordion')) &&
		i < 100
	) {
		elt = elt.parentElement;
	}
	return elt;
}

for (let accordList of allAccordions) {
	accordList.addEventListener('click', e => {
		e.preventDefault();
		clickedAccordItem = findParentAccordItem(e.target);
		clickedAccordMenuItems = clickedAccordItem.parentElement.getElementsByTagName("LI");

		for (let accordItem of clickedAccordMenuItems) {
			if (accordItem == clickedAccordItem) {
				accordItem.classList.toggle('is-active');
			} else {
				accordItem.classList.remove('is-active');
			}
		}
	})
};


// Слайдер с Бургерами
slider = new Siema({
	selector: '.burgers__list',
	duration: 200,
	easing: 'ease-out',
	perPage: 1,
	startIndex: 0,
	draggable: true,
	multipleDrag: true,
	threshold: 20,
	loop: true,
	rtl: false,
	// onInit: () => {},
	// onChange: () => {},
});

sliderNextBtn = document.getElementById('burgers_slider-control--next');
sliderNextBtn.addEventListener('click', (e) => {
	e.preventDefault();
	slider.next()
});

sliderPrevBtn = document.getElementById('burgers_slider-control--prev');
sliderPrevBtn.addEventListener('click', (e) => {
	e.preventDefault();
	slider.prev()
});


// AJAX and Order Form
const orderForm = document.getElementById('order-form');


orderForm.addEventListener('submit', e => {
	e.preventDefault();
	const formData = new FormData(),
		URL = "https://webdev-api.loftschool.com/sendmail",
		xhr = new XMLHttpRequest();

	xhr.resposeType = 'json';
	xhr.open("POST", URL);
	xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");

	formData.append('name', orderForm.elements.customerName.value);
	formData.append('phone', orderForm.elements.phone.value);
	formData.append('comment', orderForm.elements.comment.value);
	formData.append('to', 'someemail@mail.ru');

	xhr.send(formData);
	xhr.onload = function () {
		let orderResponse = JSON.parse(xhr.responseText);
		if (orderResponse.status === 1 && xhr.status < 400) { //status 0 fail send
			openModal(name = 'Сообщение', text = orderResponse.message);; //status 1 success send
			orderForm.reset();
		} else {
			openModal(name = 'Ошибка', text = orderResponse.message);
		};
	}
});

// Burgers - скрыть.показать ингредиенты
// let ingredientsVisibility = () => {
$(".ingredients").on({
	// click: e => {
	// 	e.preventDefault();
	// 	$(e.currentTarget).toggleClass('is-active');
	// },
	mouseenter: e => {
		$(e.currentTarget).toggleClass('is-active');
	},
	mouseleave: e => {
		$(e.currentTarget).removeClass('is-active');
	}
})

// };
// Скопипащено с официальной документации
if (false) {

	ymaps.ready(function () {
		var myMap = new ymaps.Map('map', {
				center: [59.93, 30.33],
				zoom: 12
			}, {
				searchControlProvider: 'yandex#search'
			}),
			clusterer = new ymaps.Clusterer({
				// Зададим массив, описывающий иконки кластеров разного размера.
				clusterIcons: [{
						href: '../img/contacts/map-marker.png',
						size: [46, 58],
						offset: [-23, -29]
					},
					{
						href: '../img/contacts/map-marker.png',
						size: [46, 58],
						offset: [-23, -29]
					}
				],
				// Эта опция отвечает за размеры кластеров.
				// В данном случае для кластеров, содержащих до 100 элементов,
				// будет показываться маленькая иконка. Для остальных - большая.
				clusterNumbers: [8],
				clusterIconContentLayout: null
			}),
			getPointData = function (index) {
				return {
					balloonContentBody: 'тошниловка <strong>№' + index + '</strong>',
					// clusterCaption: 'метка <strong>' + index + '</strong>',
				};
			},
			points = [
				[59.9, 30.3],
				[59.95, 30.43],
				[59.97, 30.35],

			],
			geoObjects = [];

		for (var i = 0, len = points.length; i < len; i++) {
			geoObjects[i] = new ymaps.Placemark(points[i], getPointData(i), {
				iconLayout: 'default#imageWithContent',
				iconImageHref: '../img/contacts/map-marker.png',
				iconImageSize: [46, 58],
				iconImageOffset: [-23, -29]
			});
		}

		clusterer.add(geoObjects);
		myMap.geoObjects.add(clusterer);

		myMap.setBounds(clusterer.getBounds(), {
			checkZoomRange: true
		});
	});
}
var initOps = (() => {
	ops = {};
	ops.model = (() => {
		var currentPosition = 0;
		const minPosition = 0,
			maxPosition = $('.section').length - 1;

		moveTo = ((newPosition) => {
			isLastPosition = (newPosition === maxPosition);
			if (newPosition != currentPosition) {
				ops.view.goToSection(newPosition, isLastPosition);
				currentPosition = newPosition;
			}
		})
		moveOn = ((deltaY) => {
			let newPosition = Math.max(
				Math.min((currentPosition + deltaY), maxPosition),
				minPosition
			)
			moveTo(newPosition);
		})

		moveDown = function () {
			currentPosition < maxPosition ? ops.model.moveOn(1) : ops.model.moveTo(0);
		}
		return {
			moveTo,
			moveOn,
			moveDown
		}
	})()

	ops.view = (() => {
		opsContainer = $('.ops__container');
		downButton = $('.down-btn');
		opsSliderItems = $('.ops-slider__item');

		goToSection = ((position, isLastPosition = false) => {
			translatePropery = `translateY(${-position * 100}vh)`;
			opsContainer.css({
				transform: translatePropery
			});
			opsSliderItems.removeClass('is-active');
			opsSliderItems.eq(position).addClass('is-active');
			if (isLastPosition) {
				downButton.css('transform', "rotate(180deg)")
			} else {
				downButton.css('transform', "rotate(0deg)")
			}
		})
		return {
			goToSection
		}
	})();

	ops.controll = (() => {
		$('.ops').on('wheel', e => {
			e.preventDefault();
			ops.model.moveOn(Math.floor(e.originalEvent.deltaY / 100));
		});
		$('.down-btn').on('click', e => {
			e.preventDefault();
			ops.model.moveDown();
		});
		$('.ops-slider li').on('click', function (e) {
			e.preventDefault();
			ops.model.moveTo($(this).index());
		})
		$(document).on({
			'keydown': e => {
				switch (e.keyCode) {
					case 40:
						ops.model.moveOn(1);
						break;
					case 38:
						ops.model.moveOn(-1);
						break;
				}
			}
		})

		$(document).swipe({
			swipe: function (event, direction, distance, duration, fingerCount) {
				console.log(distance, duration);
				if (direction === 'up') {
					ops.model.moveOn(-1);
				} else if (direction === 'down') {
					ops.model.moveOn(1);
				}
			},
			fingers: 'all'
		});

	})()
});


initOps();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsIm1hcC5qcyIsIm9wcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEhhbWJ1cmdlciBtZW51XHJcbmNvbnN0IG1lbnVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGFtYnVyZ2VyLW1lbnUtbGluaycpLFxyXG5cdGhhbU1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFtYnVyZ2VyLW1lbnUnKSxcclxuXHRoYW1MaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hdl9fbGlzdF9oYW1idXJnZXInKSxcclxuXHRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xyXG5oYW1MaXN0SXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubmF2X2hhbWJ1cmdlciAubmF2X19pdGVtJyk7XHJcblxyXG5cclxuZnVuY3Rpb24g0LBzbGVlcChtcykge1xyXG5cdHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gdG9nZ2xlTWVudSgpIHtcclxuXHRtZW51QnRuLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG5cdGhhbU1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcblx0Ym9keS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1sb2NrZWQnKTtcclxuXHJcblx0Zm9yIChsZXQgaGFtTGlzdEl0ZW0gb2YgaGFtTGlzdEl0ZW1zKSB7XHJcblx0XHRoYW1MaXN0SXRlbS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuXHRcdGF3YWl0INCwc2xlZXAoMTAwKTtcclxuXHJcblx0fTtcclxufTtcclxuXHJcbm1lbnVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuXHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0dG9nZ2xlTWVudSgpO1xyXG59KTtcclxuaGFtTGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdGxldCBlbCA9IGUudGFyZ2V0O1xyXG5cdGlmIChlbC50YWdOYW1lID09ICdBJykge1xyXG5cdFx0dG9nZ2xlTWVudSgpO1xyXG5cdH07XHJcbn0pO1xyXG5cclxuXHJcbi8vIE1vZGFsXHJcbm1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsJyk7XHJcblxyXG5mdW5jdGlvbiBvcGVuTW9kYWwobmFtZSA9ICcnLCB0ZXh0ID0gJycsIGV2ZW50ID0gZmFsc2UpIHtcclxuXHQoZXZlbnQgPyBldmVudC5wcmV2ZW50RGVmYXVsdCgpIDogdm9pZCgwKSk7IC8vINCV0YHQu9C4INC80L7QtNCw0LvQutCwINC+0YLQutGA0YvRgtCwINC90LUg0L/QviDQutC70LjQutGDINC40Lcg0LjQtyBBSkFYXHJcblx0bW9kYWwuY2xhc3NMaXN0LmFkZCgnaXMtYWN0aXZlJyk7XHJcblx0bW9kYWwucXVlcnlTZWxlY3RvcignI21vZGFsX19uYW1lJykudGV4dENvbnRlbnQgPSBuYW1lO1xyXG5cdG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJyNtb2RhbF9fdGV4dCcpLnRleHRDb250ZW50ID0gdGV4dDtcclxuXHRib2R5LmNsYXNzTGlzdC5hZGQoJ2lzLWxvY2tlZCcpO1xyXG59XHJcbiQoJy5yZXZpZXdzX19pdGVtIC5idG4nKS5vbignY2xpY2snLCAoZSkgPT4ge1xyXG5cdG9wZW5Nb2RhbChcclxuXHRcdG5hbWUgPSAkKGUudGFyZ2V0KS5zaWJsaW5ncyhcIi5yZXZpZXdzX190aXRsZVwiKS50ZXh0KCksXHJcblx0XHR0ZXh0ID0gJChlLnRhcmdldCkuc2libGluZ3MoXCIucmV2aWV3c19fdGV4dFwiKS50ZXh0KCksXHJcblx0XHRldmVudCA9IGVcclxuXHQpO1xyXG59KTtcclxuXHJcbi8vINCX0LDQutGA0YvRgtC40LUg0J7QutC90LBcclxuJCgnLm1vZGFsJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuXHRpZiAoZS50YXJnZXQgPT0gbW9kYWwgfHwgZS50YXJnZXQgPT0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpKSB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcclxuXHRcdGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnaXMtbG9ja2VkJyk7XHJcblx0fVxyXG59KVxyXG5cclxuLy/Ql9Cw0LrRgNGL0YLQuNC1INC80L7QtNCw0LvQutC4INC40LvQuCDQvNC10L3RjiDQvdCwIEVzY1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBlID0+IHtcclxuXHRpZiAoZS5rZXlDb2RlID09IDI3KSB7IC8vINC30LDQutGA0YvQstCw0LXQvCDQs9Cw0LHQvNGD0YDQs9C10YAg0LzQtdC90Y5cclxuXHRcdGlmIChoYW1NZW51LmNsYXNzTGlzdC5jb250YWlucygnaXMtYWN0aXZlJykpIHtcclxuXHRcdFx0dG9nZ2xlTWVudSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChtb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoJ2lzLWFjdGl2ZScpKSB7IC8vINC30LDQutGA0YvQstCw0LXQvCDQvNC+0LTQsNC70LrRg1xyXG5cdFx0XHRtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcclxuXHRcdFx0Ym9keS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1sb2NrZWQnKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG59KTtcclxuXHJcblxyXG5cclxuLy8gYWxsIEFjY29yZGlvbnNcclxuYWxsQWNjb3JkaW9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2FjY29yZGlvbicpO1xyXG5cclxuLy8g0JjRidC10Lwg0LHQu9C40LbQsNC50YjQtdCz0L4g0YDQvtC00LjRgtC10LvRjyDQv9C10YDQtdC00LDQvdC90L7Qs9C+IGUudGFyZ2V0ICxcclxuLy8g0YMg0LrQvtGC0L7RgNC+0LPQviDRgNCw0LTQuNGC0LXQu9GMIC0gYWNjb3JkaW9uXHJcbmZ1bmN0aW9uIGZpbmRQYXJlbnRBY2NvcmRJdGVtKGVsdCkge1xyXG5cdGxldCBpID0gMDsgLy8g0LfQsNGJ0LjRgtCwINC+0YIg0LfQsNGG0LjQutC70LDQstCw0L3QuNGPXHJcblx0d2hpbGUgKFxyXG5cdFx0IShlbHQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjY29yZGlvbicpKSAmJlxyXG5cdFx0aSA8IDEwMFxyXG5cdCkge1xyXG5cdFx0ZWx0ID0gZWx0LnBhcmVudEVsZW1lbnQ7XHJcblx0fVxyXG5cdHJldHVybiBlbHQ7XHJcbn1cclxuXHJcbmZvciAobGV0IGFjY29yZExpc3Qgb2YgYWxsQWNjb3JkaW9ucykge1xyXG5cdGFjY29yZExpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdGNsaWNrZWRBY2NvcmRJdGVtID0gZmluZFBhcmVudEFjY29yZEl0ZW0oZS50YXJnZXQpO1xyXG5cdFx0Y2xpY2tlZEFjY29yZE1lbnVJdGVtcyA9IGNsaWNrZWRBY2NvcmRJdGVtLnBhcmVudEVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJMSVwiKTtcclxuXHJcblx0XHRmb3IgKGxldCBhY2NvcmRJdGVtIG9mIGNsaWNrZWRBY2NvcmRNZW51SXRlbXMpIHtcclxuXHRcdFx0aWYgKGFjY29yZEl0ZW0gPT0gY2xpY2tlZEFjY29yZEl0ZW0pIHtcclxuXHRcdFx0XHRhY2NvcmRJdGVtLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGFjY29yZEl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9KVxyXG59O1xyXG5cclxuXHJcbi8vINCh0LvQsNC50LTQtdGAINGBINCR0YPRgNCz0LXRgNCw0LzQuFxyXG5zbGlkZXIgPSBuZXcgU2llbWEoe1xyXG5cdHNlbGVjdG9yOiAnLmJ1cmdlcnNfX2xpc3QnLFxyXG5cdGR1cmF0aW9uOiAyMDAsXHJcblx0ZWFzaW5nOiAnZWFzZS1vdXQnLFxyXG5cdHBlclBhZ2U6IDEsXHJcblx0c3RhcnRJbmRleDogMCxcclxuXHRkcmFnZ2FibGU6IHRydWUsXHJcblx0bXVsdGlwbGVEcmFnOiB0cnVlLFxyXG5cdHRocmVzaG9sZDogMjAsXHJcblx0bG9vcDogdHJ1ZSxcclxuXHRydGw6IGZhbHNlLFxyXG5cdC8vIG9uSW5pdDogKCkgPT4ge30sXHJcblx0Ly8gb25DaGFuZ2U6ICgpID0+IHt9LFxyXG59KTtcclxuXHJcbnNsaWRlck5leHRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVyZ2Vyc19zbGlkZXItY29udHJvbC0tbmV4dCcpO1xyXG5zbGlkZXJOZXh0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuXHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0c2xpZGVyLm5leHQoKVxyXG59KTtcclxuXHJcbnNsaWRlclByZXZCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVyZ2Vyc19zbGlkZXItY29udHJvbC0tcHJldicpO1xyXG5zbGlkZXJQcmV2QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuXHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0c2xpZGVyLnByZXYoKVxyXG59KTtcclxuXHJcblxyXG4vLyBBSkFYIGFuZCBPcmRlciBGb3JtXHJcbmNvbnN0IG9yZGVyRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmRlci1mb3JtJyk7XHJcblxyXG5cclxub3JkZXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGUgPT4ge1xyXG5cdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpLFxyXG5cdFx0VVJMID0gXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcclxuXHRcdHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG5cclxuXHR4aHIucmVzcG9zZVR5cGUgPSAnanNvbic7XHJcblx0eGhyLm9wZW4oXCJQT1NUXCIsIFVSTCk7XHJcblx0eGhyLnNldFJlcXVlc3RIZWFkZXIoXCJYLVJlcXVlc3RlZC1XaXRoXCIsIFwiWE1MSHR0cFJlcXVlc3RcIik7XHJcblxyXG5cdGZvcm1EYXRhLmFwcGVuZCgnbmFtZScsIG9yZGVyRm9ybS5lbGVtZW50cy5jdXN0b21lck5hbWUudmFsdWUpO1xyXG5cdGZvcm1EYXRhLmFwcGVuZCgncGhvbmUnLCBvcmRlckZvcm0uZWxlbWVudHMucGhvbmUudmFsdWUpO1xyXG5cdGZvcm1EYXRhLmFwcGVuZCgnY29tbWVudCcsIG9yZGVyRm9ybS5lbGVtZW50cy5jb21tZW50LnZhbHVlKTtcclxuXHRmb3JtRGF0YS5hcHBlbmQoJ3RvJywgJ3NvbWVlbWFpbEBtYWlsLnJ1Jyk7XHJcblxyXG5cdHhoci5zZW5kKGZvcm1EYXRhKTtcclxuXHR4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0bGV0IG9yZGVyUmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG5cdFx0aWYgKG9yZGVyUmVzcG9uc2Uuc3RhdHVzID09PSAxICYmIHhoci5zdGF0dXMgPCA0MDApIHsgLy9zdGF0dXMgMCBmYWlsIHNlbmRcclxuXHRcdFx0b3Blbk1vZGFsKG5hbWUgPSAn0KHQvtC+0LHRidC10L3QuNC1JywgdGV4dCA9IG9yZGVyUmVzcG9uc2UubWVzc2FnZSk7OyAvL3N0YXR1cyAxIHN1Y2Nlc3Mgc2VuZFxyXG5cdFx0XHRvcmRlckZvcm0ucmVzZXQoKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdG9wZW5Nb2RhbChuYW1lID0gJ9Ce0YjQuNCx0LrQsCcsIHRleHQgPSBvcmRlclJlc3BvbnNlLm1lc3NhZ2UpO1xyXG5cdFx0fTtcclxuXHR9XHJcbn0pO1xyXG5cclxuLy8gQnVyZ2VycyAtINGB0LrRgNGL0YLRjC7Qv9C+0LrQsNC30LDRgtGMINC40L3Qs9GA0LXQtNC40LXQvdGC0YtcclxuLy8gbGV0IGluZ3JlZGllbnRzVmlzaWJpbGl0eSA9ICgpID0+IHtcclxuJChcIi5pbmdyZWRpZW50c1wiKS5vbih7XHJcblx0Ly8gY2xpY2s6IGUgPT4ge1xyXG5cdC8vIFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdC8vIFx0JChlLmN1cnJlbnRUYXJnZXQpLnRvZ2dsZUNsYXNzKCdpcy1hY3RpdmUnKTtcclxuXHQvLyB9LFxyXG5cdG1vdXNlZW50ZXI6IGUgPT4ge1xyXG5cdFx0JChlLmN1cnJlbnRUYXJnZXQpLnRvZ2dsZUNsYXNzKCdpcy1hY3RpdmUnKTtcclxuXHR9LFxyXG5cdG1vdXNlbGVhdmU6IGUgPT4ge1xyXG5cdFx0JChlLmN1cnJlbnRUYXJnZXQpLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTtcclxuXHR9XHJcbn0pXHJcblxyXG4vLyB9OyIsIi8vINCh0LrQvtC/0LjQv9Cw0YnQtdC90L4g0YEg0L7RhNC40YbQuNCw0LvRjNC90L7QuSDQtNC+0LrRg9C80LXQvdGC0LDRhtC40LhcclxuaWYgKGZhbHNlKSB7XHJcblxyXG5cdHltYXBzLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuXHRcdHZhciBteU1hcCA9IG5ldyB5bWFwcy5NYXAoJ21hcCcsIHtcclxuXHRcdFx0XHRjZW50ZXI6IFs1OS45MywgMzAuMzNdLFxyXG5cdFx0XHRcdHpvb206IDEyXHJcblx0XHRcdH0sIHtcclxuXHRcdFx0XHRzZWFyY2hDb250cm9sUHJvdmlkZXI6ICd5YW5kZXgjc2VhcmNoJ1xyXG5cdFx0XHR9KSxcclxuXHRcdFx0Y2x1c3RlcmVyID0gbmV3IHltYXBzLkNsdXN0ZXJlcih7XHJcblx0XHRcdFx0Ly8g0JfQsNC00LDQtNC40Lwg0LzQsNGB0YHQuNCyLCDQvtC/0LjRgdGL0LLQsNGO0YnQuNC5INC40LrQvtC90LrQuCDQutC70LDRgdGC0LXRgNC+0LIg0YDQsNC30L3QvtCz0L4g0YDQsNC30LzQtdGA0LAuXHJcblx0XHRcdFx0Y2x1c3Rlckljb25zOiBbe1xyXG5cdFx0XHRcdFx0XHRocmVmOiAnLi4vaW1nL2NvbnRhY3RzL21hcC1tYXJrZXIucG5nJyxcclxuXHRcdFx0XHRcdFx0c2l6ZTogWzQ2LCA1OF0sXHJcblx0XHRcdFx0XHRcdG9mZnNldDogWy0yMywgLTI5XVxyXG5cdFx0XHRcdFx0fSxcclxuXHRcdFx0XHRcdHtcclxuXHRcdFx0XHRcdFx0aHJlZjogJy4uL2ltZy9jb250YWN0cy9tYXAtbWFya2VyLnBuZycsXHJcblx0XHRcdFx0XHRcdHNpemU6IFs0NiwgNThdLFxyXG5cdFx0XHRcdFx0XHRvZmZzZXQ6IFstMjMsIC0yOV1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRdLFxyXG5cdFx0XHRcdC8vINCt0YLQsCDQvtC/0YbQuNGPINC+0YLQstC10YfQsNC10YIg0LfQsCDRgNCw0LfQvNC10YDRiyDQutC70LDRgdGC0LXRgNC+0LIuXHJcblx0XHRcdFx0Ly8g0JIg0LTQsNC90L3QvtC8INGB0LvRg9GH0LDQtSDQtNC70Y8g0LrQu9Cw0YHRgtC10YDQvtCyLCDRgdC+0LTQtdGA0LbQsNGJ0LjRhSDQtNC+IDEwMCDRjdC70LXQvNC10L3RgtC+0LIsXHJcblx0XHRcdFx0Ly8g0LHRg9C00LXRgiDQv9C+0LrQsNC30YvQstCw0YLRjNGB0Y8g0LzQsNC70LXQvdGM0LrQsNGPINC40LrQvtC90LrQsC4g0JTQu9GPINC+0YHRgtCw0LvRjNC90YvRhSAtINCx0L7Qu9GM0YjQsNGPLlxyXG5cdFx0XHRcdGNsdXN0ZXJOdW1iZXJzOiBbOF0sXHJcblx0XHRcdFx0Y2x1c3Rlckljb25Db250ZW50TGF5b3V0OiBudWxsXHJcblx0XHRcdH0pLFxyXG5cdFx0XHRnZXRQb2ludERhdGEgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuXHRcdFx0XHRyZXR1cm4ge1xyXG5cdFx0XHRcdFx0YmFsbG9vbkNvbnRlbnRCb2R5OiAn0YLQvtGI0L3QuNC70L7QstC60LAgPHN0cm9uZz7ihJYnICsgaW5kZXggKyAnPC9zdHJvbmc+JyxcclxuXHRcdFx0XHRcdC8vIGNsdXN0ZXJDYXB0aW9uOiAn0LzQtdGC0LrQsCA8c3Ryb25nPicgKyBpbmRleCArICc8L3N0cm9uZz4nLFxyXG5cdFx0XHRcdH07XHJcblx0XHRcdH0sXHJcblx0XHRcdHBvaW50cyA9IFtcclxuXHRcdFx0XHRbNTkuOSwgMzAuM10sXHJcblx0XHRcdFx0WzU5Ljk1LCAzMC40M10sXHJcblx0XHRcdFx0WzU5Ljk3LCAzMC4zNV0sXHJcblxyXG5cdFx0XHRdLFxyXG5cdFx0XHRnZW9PYmplY3RzID0gW107XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIGxlbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRnZW9PYmplY3RzW2ldID0gbmV3IHltYXBzLlBsYWNlbWFyayhwb2ludHNbaV0sIGdldFBvaW50RGF0YShpKSwge1xyXG5cdFx0XHRcdGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlV2l0aENvbnRlbnQnLFxyXG5cdFx0XHRcdGljb25JbWFnZUhyZWY6ICcuLi9pbWcvY29udGFjdHMvbWFwLW1hcmtlci5wbmcnLFxyXG5cdFx0XHRcdGljb25JbWFnZVNpemU6IFs0NiwgNThdLFxyXG5cdFx0XHRcdGljb25JbWFnZU9mZnNldDogWy0yMywgLTI5XVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHRjbHVzdGVyZXIuYWRkKGdlb09iamVjdHMpO1xyXG5cdFx0bXlNYXAuZ2VvT2JqZWN0cy5hZGQoY2x1c3RlcmVyKTtcclxuXHJcblx0XHRteU1hcC5zZXRCb3VuZHMoY2x1c3RlcmVyLmdldEJvdW5kcygpLCB7XHJcblx0XHRcdGNoZWNrWm9vbVJhbmdlOiB0cnVlXHJcblx0XHR9KTtcclxuXHR9KTtcclxufSIsInZhciBpbml0T3BzID0gKCgpID0+IHtcclxuXHRvcHMgPSB7fTtcclxuXHRvcHMubW9kZWwgPSAoKCkgPT4ge1xyXG5cdFx0dmFyIGN1cnJlbnRQb3NpdGlvbiA9IDA7XHJcblx0XHRjb25zdCBtaW5Qb3NpdGlvbiA9IDAsXHJcblx0XHRcdG1heFBvc2l0aW9uID0gJCgnLnNlY3Rpb24nKS5sZW5ndGggLSAxO1xyXG5cclxuXHRcdG1vdmVUbyA9ICgobmV3UG9zaXRpb24pID0+IHtcclxuXHRcdFx0aXNMYXN0UG9zaXRpb24gPSAobmV3UG9zaXRpb24gPT09IG1heFBvc2l0aW9uKTtcclxuXHRcdFx0aWYgKG5ld1Bvc2l0aW9uICE9IGN1cnJlbnRQb3NpdGlvbikge1xyXG5cdFx0XHRcdG9wcy52aWV3LmdvVG9TZWN0aW9uKG5ld1Bvc2l0aW9uLCBpc0xhc3RQb3NpdGlvbik7XHJcblx0XHRcdFx0Y3VycmVudFBvc2l0aW9uID0gbmV3UG9zaXRpb247XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblx0XHRtb3ZlT24gPSAoKGRlbHRhWSkgPT4ge1xyXG5cdFx0XHRsZXQgbmV3UG9zaXRpb24gPSBNYXRoLm1heChcclxuXHRcdFx0XHRNYXRoLm1pbigoY3VycmVudFBvc2l0aW9uICsgZGVsdGFZKSwgbWF4UG9zaXRpb24pLFxyXG5cdFx0XHRcdG1pblBvc2l0aW9uXHJcblx0XHRcdClcclxuXHRcdFx0bW92ZVRvKG5ld1Bvc2l0aW9uKTtcclxuXHRcdH0pXHJcblxyXG5cdFx0bW92ZURvd24gPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGN1cnJlbnRQb3NpdGlvbiA8IG1heFBvc2l0aW9uID8gb3BzLm1vZGVsLm1vdmVPbigxKSA6IG9wcy5tb2RlbC5tb3ZlVG8oMCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRtb3ZlVG8sXHJcblx0XHRcdG1vdmVPbixcclxuXHRcdFx0bW92ZURvd25cclxuXHRcdH1cclxuXHR9KSgpXHJcblxyXG5cdG9wcy52aWV3ID0gKCgpID0+IHtcclxuXHRcdG9wc0NvbnRhaW5lciA9ICQoJy5vcHNfX2NvbnRhaW5lcicpO1xyXG5cdFx0ZG93bkJ1dHRvbiA9ICQoJy5kb3duLWJ0bicpO1xyXG5cdFx0b3BzU2xpZGVySXRlbXMgPSAkKCcub3BzLXNsaWRlcl9faXRlbScpO1xyXG5cclxuXHRcdGdvVG9TZWN0aW9uID0gKChwb3NpdGlvbiwgaXNMYXN0UG9zaXRpb24gPSBmYWxzZSkgPT4ge1xyXG5cdFx0XHR0cmFuc2xhdGVQcm9wZXJ5ID0gYHRyYW5zbGF0ZVkoJHstcG9zaXRpb24gKiAxMDB9dmgpYDtcclxuXHRcdFx0b3BzQ29udGFpbmVyLmNzcyh7XHJcblx0XHRcdFx0dHJhbnNmb3JtOiB0cmFuc2xhdGVQcm9wZXJ5XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRvcHNTbGlkZXJJdGVtcy5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7XHJcblx0XHRcdG9wc1NsaWRlckl0ZW1zLmVxKHBvc2l0aW9uKS5hZGRDbGFzcygnaXMtYWN0aXZlJyk7XHJcblx0XHRcdGlmIChpc0xhc3RQb3NpdGlvbikge1xyXG5cdFx0XHRcdGRvd25CdXR0b24uY3NzKCd0cmFuc2Zvcm0nLCBcInJvdGF0ZSgxODBkZWcpXCIpXHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0ZG93bkJ1dHRvbi5jc3MoJ3RyYW5zZm9ybScsIFwicm90YXRlKDBkZWcpXCIpXHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRnb1RvU2VjdGlvblxyXG5cdFx0fVxyXG5cdH0pKCk7XHJcblxyXG5cdG9wcy5jb250cm9sbCA9ICgoKSA9PiB7XHJcblx0XHQkKCcub3BzJykub24oJ3doZWVsJywgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0b3BzLm1vZGVsLm1vdmVPbihNYXRoLmZsb29yKGUub3JpZ2luYWxFdmVudC5kZWx0YVkgLyAxMDApKTtcclxuXHRcdH0pO1xyXG5cdFx0JCgnLmRvd24tYnRuJykub24oJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0b3BzLm1vZGVsLm1vdmVEb3duKCk7XHJcblx0XHR9KTtcclxuXHRcdCQoJy5vcHMtc2xpZGVyIGxpJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRvcHMubW9kZWwubW92ZVRvKCQodGhpcykuaW5kZXgoKSk7XHJcblx0XHR9KVxyXG5cdFx0JChkb2N1bWVudCkub24oe1xyXG5cdFx0XHQna2V5ZG93bic6IGUgPT4ge1xyXG5cdFx0XHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcblx0XHRcdFx0XHRjYXNlIDQwOlxyXG5cdFx0XHRcdFx0XHRvcHMubW9kZWwubW92ZU9uKDEpO1xyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdGNhc2UgMzg6XHJcblx0XHRcdFx0XHRcdG9wcy5tb2RlbC5tb3ZlT24oLTEpO1xyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0JChkb2N1bWVudCkuc3dpcGUoe1xyXG5cdFx0XHRzd2lwZTogZnVuY3Rpb24gKGV2ZW50LCBkaXJlY3Rpb24sIGRpc3RhbmNlLCBkdXJhdGlvbiwgZmluZ2VyQ291bnQpIHtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhkaXN0YW5jZSwgZHVyYXRpb24pO1xyXG5cdFx0XHRcdGlmIChkaXJlY3Rpb24gPT09ICd1cCcpIHtcclxuXHRcdFx0XHRcdG9wcy5tb2RlbC5tb3ZlT24oLTEpO1xyXG5cdFx0XHRcdH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnZG93bicpIHtcclxuXHRcdFx0XHRcdG9wcy5tb2RlbC5tb3ZlT24oMSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LFxyXG5cdFx0XHRmaW5nZXJzOiAnYWxsJ1xyXG5cdFx0fSk7XHJcblxyXG5cdH0pKClcclxufSk7XHJcblxyXG5cclxuaW5pdE9wcygpOyJdfQ==
