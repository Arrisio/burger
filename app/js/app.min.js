// Hamburger menu
const menuBtn = document.querySelector('.hamburger-menu-link'),
	hamMenu = document.getElementById('hamburger-menu'),
	hamList = document.getElementById('nav__list_hamburger'),
	body = document.querySelector('body');
hamListItems = document.querySelectorAll('.nav_hamburger .nav__item');


function аsleep(ms) {
	return new Promise(resolve => setTimeout(resolve, ms));
}

async function toggleMenu() {
	menuBtn.classList.toggle('is-active');
	hamMenu.classList.toggle('is-active');
	body.classList.toggle('is-locked');

	for (let hamListItem of hamListItems) {
		hamListItem.classList.toggle('is-active');
		await аsleep(100);

	};
};

menuBtn.addEventListener('click', e => {
	e.preventDefault();
	toggleMenu();
});
hamList.addEventListener('click', e => {
	let el = e.target;
	if (el.tagName == 'A') {
		toggleMenu();
	};
});


// Modal
modal = document.getElementById('modal');

function openModal(name = '', text = '', event = false) {
	(event ? event.preventDefault() : void(0)); // Если модалка открыта не по клику из из AJAX
	modal.classList.add('is-active');
	modal.querySelector('#modal__name').textContent = name;
	modal.querySelector('#modal__text').textContent = text;
	body.classList.add('is-locked');
}
$('.reviews__item .btn').on('click', (e) => {
	openModal(
		name = $(e.target).siblings(".reviews__title").text(),
		text = $(e.target).siblings(".reviews__text").text(),
		event = e
	);
});

// Закрытие Окна
$('.modal').on('click', (e) => {
	if (e.target == modal || e.target == modal.querySelector('.modal__close')) {
		e.preventDefault();
		modal.classList.remove('is-active');
		body.classList.remove('is-locked');
	}
})

//Закрытие модалки или меню на Esc
document.addEventListener("keydown", e => {
	if (e.keyCode == 27) { // закрываем габмургер меню
		if (hamMenu.classList.contains('is-active')) {
			toggleMenu();
		}

		if (modal.classList.contains('is-active')) { // закрываем модалку
			modal.classList.remove('is-active');
			body.classList.remove('is-locked');
		}
	}

});



// all Accordions
allAccordions = document.getElementsByClassName('accordion');

// Ищем ближайшего родителя переданного e.target ,
// у которого радитель - accordion
function findParentAccordItem(elt) {
	let i = 0; // защита от зациклавания
	while (
		!(elt.parentElement.classList.contains('accordion')) &&
		i < 100
	) {
		elt = elt.parentElement;
	}
	return elt;
}

for (let accordList of allAccordions) {
	accordList.addEventListener('click', e => {
		e.preventDefault();
		clickedAccordItem = findParentAccordItem(e.target);
		clickedAccordMenuItems = clickedAccordItem.parentElement.getElementsByTagName("LI");

		for (let accordItem of clickedAccordMenuItems) {
			if (accordItem == clickedAccordItem) {
				accordItem.classList.toggle('is-active');
			} else {
				accordItem.classList.remove('is-active');
			}
		}
	})
};


// Слайдер с Бургерами
slider = new Siema({
	selector: '.burgers__list',
	duration: 200,
	easing: 'ease-out',
	perPage: 1,
	startIndex: 0,
	draggable: true,
	multipleDrag: true,
	threshold: 20,
	loop: true,
	rtl: false,
	// onInit: () => {},
	// onChange: () => {},
});

sliderNextBtn = document.getElementById('burgers_slider-control--next');
sliderNextBtn.addEventListener('click', (e) => {
	e.preventDefault();
	slider.next()
});

sliderPrevBtn = document.getElementById('burgers_slider-control--prev');
sliderPrevBtn.addEventListener('click', (e) => {
	e.preventDefault();
	slider.prev()
});


// AJAX and Order Form
const orderForm = document.getElementById('order-form');


orderForm.addEventListener('submit', e => {
	e.preventDefault();
	const formData = new FormData(),
		URL = "https://webdev-api.loftschool.com/sendmail",
		xhr = new XMLHttpRequest();

	xhr.resposeType = 'json';
	xhr.open("POST", URL);
	xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");

	formData.append('name', orderForm.elements.customerName.value);
	formData.append('phone', orderForm.elements.phone.value);
	formData.append('comment', orderForm.elements.comment.value);
	formData.append('to', 'someemail@mail.ru');

	xhr.send(formData);
	xhr.onload = function () {
		let orderResponse = JSON.parse(xhr.responseText);
		if (orderResponse.status === 1 && xhr.status < 400) { //status 0 fail send
			openModal(name = 'Сообщение', text = orderResponse.message);; //status 1 success send
			orderForm.reset();
		} else {
			openModal(name = 'Ошибка', text = orderResponse.message);
		};
	}
});

// Burgers - скрыть.показать ингредиенты
// let ingredientsVisibility = () => {
$(".ingredients").on({
	// click: e => {
	// 	e.preventDefault();
	// 	$(e.currentTarget).toggleClass('is-active');
	// },
	mouseenter: e => {
		$(e.currentTarget).toggleClass('is-active');
	},
	mouseleave: e => {
		$(e.currentTarget).removeClass('is-active');
	}
})

// };
// Скопипащено с официальной документации
if (false) {

	ymaps.ready(function () {
		var myMap = new ymaps.Map('map', {
				center: [59.93, 30.33],
				zoom: 12
			}, {
				searchControlProvider: 'yandex#search'
			}),
			clusterer = new ymaps.Clusterer({
				// Зададим массив, описывающий иконки кластеров разного размера.
				clusterIcons: [{
						href: '../img/contacts/map-marker.png',
						size: [46, 58],
						offset: [-23, -29]
					},
					{
						href: '../img/contacts/map-marker.png',
						size: [46, 58],
						offset: [-23, -29]
					}
				],
				// Эта опция отвечает за размеры кластеров.
				// В данном случае для кластеров, содержащих до 100 элементов,
				// будет показываться маленькая иконка. Для остальных - большая.
				clusterNumbers: [8],
				clusterIconContentLayout: null
			}),
			getPointData = function (index) {
				return {
					balloonContentBody: 'тошниловка <strong>№' + index + '</strong>',
					// clusterCaption: 'метка <strong>' + index + '</strong>',
				};
			},
			points = [
				[59.9, 30.3],
				[59.95, 30.43],
				[59.97, 30.35],

			],
			geoObjects = [];

		for (var i = 0, len = points.length; i < len; i++) {
			geoObjects[i] = new ymaps.Placemark(points[i], getPointData(i), {
				iconLayout: 'default#imageWithContent',
				iconImageHref: '../img/contacts/map-marker.png',
				iconImageSize: [46, 58],
				iconImageOffset: [-23, -29]
			});
		}

		clusterer.add(geoObjects);
		myMap.geoObjects.add(clusterer);

		myMap.setBounds(clusterer.getBounds(), {
			checkZoomRange: true
		});
	});
}
var initOps = (() => {
	ops = {};
	ops.model = (() => {
		var currentPosition = 0;
		const minPosition = 0,
			maxPosition = $('.section').length - 1;

		moveTo = ((newPosition) => {
			isLastPosition = (newPosition === maxPosition);
			if (newPosition != currentPosition) {
				ops.view.goToSection(newPosition, isLastPosition);
				currentPosition = newPosition;
			}
		})
		moveOn = ((deltaY) => {
			let newPosition = Math.max(
				Math.min((currentPosition + deltaY), maxPosition),
				minPosition
			)
			moveTo(newPosition);
		})

		moveDown = function () {
			currentPosition < maxPosition ? ops.model.moveOn(1) : ops.model.moveTo(0);
		}
		return {
			moveTo,
			moveOn,
			moveDown
		}
	})()

	ops.view = (() => {
		opsContainer = $('.ops__container');
		downButton = $('.down-btn');
		opsSliderItems = $('.ops-slider__item');

		goToSection = ((position, isLastPosition = false) => {
			translatePropery = `translateY(${-position * 100}vh)`;
			opsContainer.css({
				transform: translatePropery
			});
			opsSliderItems.removeClass('is-active');
			opsSliderItems.eq(position).addClass('is-active');
			if (isLastPosition) {
				downButton.css('transform', "rotate(180deg)")
			} else {
				downButton.css('transform', "rotate(0deg)")
			}
		})
		return {
			goToSection
		}
	})();

	ops.controll = (() => {
		$('.ops').on('wheel', e => {
			e.preventDefault();
			ops.model.moveOn(Math.floor(e.originalEvent.deltaY / 100));
		});
		$('.down-btn').on('click', e => {
			e.preventDefault();
			ops.model.moveDown();
		});
		$('.ops-slider li').on('click', function (e) {
			e.preventDefault();
			ops.model.moveTo($(this).index());
		})
		$(document).on({
			'keydown': e => {
				switch (e.keyCode) {
					case 40:
						ops.model.moveOn(1);
						break;
					case 38:
						ops.model.moveOn(-1);
						break;
				}
			}
		})

	})()
});


initOps();




// touchmove: e => e.PreventDefault()
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsIm1hcC5qcyIsIm9wcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBIYW1idXJnZXIgbWVudVxyXG5jb25zdCBtZW51QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhhbWJ1cmdlci1tZW51LWxpbmsnKSxcclxuXHRoYW1NZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hhbWJ1cmdlci1tZW51JyksXHJcblx0aGFtTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXZfX2xpc3RfaGFtYnVyZ2VyJyksXHJcblx0Ym9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcclxuaGFtTGlzdEl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm5hdl9oYW1idXJnZXIgLm5hdl9faXRlbScpO1xyXG5cclxuXHJcbmZ1bmN0aW9uINCwc2xlZXAobXMpIHtcclxuXHRyZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHRvZ2dsZU1lbnUoKSB7XHJcblx0bWVudUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuXHRoYW1NZW51LmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG5cdGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtbG9ja2VkJyk7XHJcblxyXG5cdGZvciAobGV0IGhhbUxpc3RJdGVtIG9mIGhhbUxpc3RJdGVtcykge1xyXG5cdFx0aGFtTGlzdEl0ZW0uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcblx0XHRhd2FpdCDQsHNsZWVwKDEwMCk7XHJcblxyXG5cdH07XHJcbn07XHJcblxyXG5tZW51QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdHRvZ2dsZU1lbnUoKTtcclxufSk7XHJcbmhhbUxpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuXHRsZXQgZWwgPSBlLnRhcmdldDtcclxuXHRpZiAoZWwudGFnTmFtZSA9PSAnQScpIHtcclxuXHRcdHRvZ2dsZU1lbnUoKTtcclxuXHR9O1xyXG59KTtcclxuXHJcblxyXG4vLyBNb2RhbFxyXG5tb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbCcpO1xyXG5cclxuZnVuY3Rpb24gb3Blbk1vZGFsKG5hbWUgPSAnJywgdGV4dCA9ICcnLCBldmVudCA9IGZhbHNlKSB7XHJcblx0KGV2ZW50ID8gZXZlbnQucHJldmVudERlZmF1bHQoKSA6IHZvaWQoMCkpOyAvLyDQldGB0LvQuCDQvNC+0LTQsNC70LrQsCDQvtGC0LrRgNGL0YLQsCDQvdC1INC/0L4g0LrQu9C40LrRgyDQuNC3INC40LcgQUpBWFxyXG5cdG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2lzLWFjdGl2ZScpO1xyXG5cdG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJyNtb2RhbF9fbmFtZScpLnRleHRDb250ZW50ID0gbmFtZTtcclxuXHRtb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWxfX3RleHQnKS50ZXh0Q29udGVudCA9IHRleHQ7XHJcblx0Ym9keS5jbGFzc0xpc3QuYWRkKCdpcy1sb2NrZWQnKTtcclxufVxyXG4kKCcucmV2aWV3c19faXRlbSAuYnRuJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuXHRvcGVuTW9kYWwoXHJcblx0XHRuYW1lID0gJChlLnRhcmdldCkuc2libGluZ3MoXCIucmV2aWV3c19fdGl0bGVcIikudGV4dCgpLFxyXG5cdFx0dGV4dCA9ICQoZS50YXJnZXQpLnNpYmxpbmdzKFwiLnJldmlld3NfX3RleHRcIikudGV4dCgpLFxyXG5cdFx0ZXZlbnQgPSBlXHJcblx0KTtcclxufSk7XHJcblxyXG4vLyDQl9Cw0LrRgNGL0YLQuNC1INCe0LrQvdCwXHJcbiQoJy5tb2RhbCcpLm9uKCdjbGljaycsIChlKSA9PiB7XHJcblx0aWYgKGUudGFyZ2V0ID09IG1vZGFsIHx8IGUudGFyZ2V0ID09IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0bW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XHJcblx0XHRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWxvY2tlZCcpO1xyXG5cdH1cclxufSlcclxuXHJcbi8v0JfQsNC60YDRi9GC0LjQtSDQvNC+0LTQsNC70LrQuCDQuNC70Lgg0LzQtdC90Y4g0L3QsCBFc2NcclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZSA9PiB7XHJcblx0aWYgKGUua2V5Q29kZSA9PSAyNykgeyAvLyDQt9Cw0LrRgNGL0LLQsNC10Lwg0LPQsNCx0LzRg9GA0LPQtdGAINC80LXQvdGOXHJcblx0XHRpZiAoaGFtTWVudS5jbGFzc0xpc3QuY29udGFpbnMoJ2lzLWFjdGl2ZScpKSB7XHJcblx0XHRcdHRvZ2dsZU1lbnUoKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAobW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1hY3RpdmUnKSkgeyAvLyDQt9Cw0LrRgNGL0LLQsNC10Lwg0LzQvtC00LDQu9C60YNcclxuXHRcdFx0bW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XHJcblx0XHRcdGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnaXMtbG9ja2VkJyk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxufSk7XHJcblxyXG5cclxuXHJcbi8vIGFsbCBBY2NvcmRpb25zXHJcbmFsbEFjY29yZGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhY2NvcmRpb24nKTtcclxuXHJcbi8vINCY0YnQtdC8INCx0LvQuNC20LDQudGI0LXQs9C+INGA0L7QtNC40YLQtdC70Y8g0L/QtdGA0LXQtNCw0L3QvdC+0LPQviBlLnRhcmdldCAsXHJcbi8vINGDINC60L7RgtC+0YDQvtCz0L4g0YDQsNC00LjRgtC10LvRjCAtIGFjY29yZGlvblxyXG5mdW5jdGlvbiBmaW5kUGFyZW50QWNjb3JkSXRlbShlbHQpIHtcclxuXHRsZXQgaSA9IDA7IC8vINC30LDRidC40YLQsCDQvtGCINC30LDRhtC40LrQu9Cw0LLQsNC90LjRj1xyXG5cdHdoaWxlIChcclxuXHRcdCEoZWx0LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY2NvcmRpb24nKSkgJiZcclxuXHRcdGkgPCAxMDBcclxuXHQpIHtcclxuXHRcdGVsdCA9IGVsdC5wYXJlbnRFbGVtZW50O1xyXG5cdH1cclxuXHRyZXR1cm4gZWx0O1xyXG59XHJcblxyXG5mb3IgKGxldCBhY2NvcmRMaXN0IG9mIGFsbEFjY29yZGlvbnMpIHtcclxuXHRhY2NvcmRMaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRjbGlja2VkQWNjb3JkSXRlbSA9IGZpbmRQYXJlbnRBY2NvcmRJdGVtKGUudGFyZ2V0KTtcclxuXHRcdGNsaWNrZWRBY2NvcmRNZW51SXRlbXMgPSBjbGlja2VkQWNjb3JkSXRlbS5wYXJlbnRFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiTElcIik7XHJcblxyXG5cdFx0Zm9yIChsZXQgYWNjb3JkSXRlbSBvZiBjbGlja2VkQWNjb3JkTWVudUl0ZW1zKSB7XHJcblx0XHRcdGlmIChhY2NvcmRJdGVtID09IGNsaWNrZWRBY2NvcmRJdGVtKSB7XHJcblx0XHRcdFx0YWNjb3JkSXRlbS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRhY2NvcmRJdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWFjdGl2ZScpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSlcclxufTtcclxuXHJcblxyXG4vLyDQodC70LDQudC00LXRgCDRgSDQkdGD0YDQs9C10YDQsNC80Lhcclxuc2xpZGVyID0gbmV3IFNpZW1hKHtcclxuXHRzZWxlY3RvcjogJy5idXJnZXJzX19saXN0JyxcclxuXHRkdXJhdGlvbjogMjAwLFxyXG5cdGVhc2luZzogJ2Vhc2Utb3V0JyxcclxuXHRwZXJQYWdlOiAxLFxyXG5cdHN0YXJ0SW5kZXg6IDAsXHJcblx0ZHJhZ2dhYmxlOiB0cnVlLFxyXG5cdG11bHRpcGxlRHJhZzogdHJ1ZSxcclxuXHR0aHJlc2hvbGQ6IDIwLFxyXG5cdGxvb3A6IHRydWUsXHJcblx0cnRsOiBmYWxzZSxcclxuXHQvLyBvbkluaXQ6ICgpID0+IHt9LFxyXG5cdC8vIG9uQ2hhbmdlOiAoKSA9PiB7fSxcclxufSk7XHJcblxyXG5zbGlkZXJOZXh0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1cmdlcnNfc2xpZGVyLWNvbnRyb2wtLW5leHQnKTtcclxuc2xpZGVyTmV4dEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdHNsaWRlci5uZXh0KClcclxufSk7XHJcblxyXG5zbGlkZXJQcmV2QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1cmdlcnNfc2xpZGVyLWNvbnRyb2wtLXByZXYnKTtcclxuc2xpZGVyUHJldkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdHNsaWRlci5wcmV2KClcclxufSk7XHJcblxyXG5cclxuLy8gQUpBWCBhbmQgT3JkZXIgRm9ybVxyXG5jb25zdCBvcmRlckZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3JkZXItZm9ybScpO1xyXG5cclxuXHJcbm9yZGVyRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBlID0+IHtcclxuXHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0Y29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKSxcclxuXHRcdFVSTCA9IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcblx0XHR4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuXHJcblx0eGhyLnJlc3Bvc2VUeXBlID0gJ2pzb24nO1xyXG5cdHhoci5vcGVuKFwiUE9TVFwiLCBVUkwpO1xyXG5cdHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiWC1SZXF1ZXN0ZWQtV2l0aFwiLCBcIlhNTEh0dHBSZXF1ZXN0XCIpO1xyXG5cclxuXHRmb3JtRGF0YS5hcHBlbmQoJ25hbWUnLCBvcmRlckZvcm0uZWxlbWVudHMuY3VzdG9tZXJOYW1lLnZhbHVlKTtcclxuXHRmb3JtRGF0YS5hcHBlbmQoJ3Bob25lJywgb3JkZXJGb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlKTtcclxuXHRmb3JtRGF0YS5hcHBlbmQoJ2NvbW1lbnQnLCBvcmRlckZvcm0uZWxlbWVudHMuY29tbWVudC52YWx1ZSk7XHJcblx0Zm9ybURhdGEuYXBwZW5kKCd0bycsICdzb21lZW1haWxAbWFpbC5ydScpO1xyXG5cclxuXHR4aHIuc2VuZChmb3JtRGF0YSk7XHJcblx0eGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdGxldCBvcmRlclJlc3BvbnNlID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcclxuXHRcdGlmIChvcmRlclJlc3BvbnNlLnN0YXR1cyA9PT0gMSAmJiB4aHIuc3RhdHVzIDwgNDAwKSB7IC8vc3RhdHVzIDAgZmFpbCBzZW5kXHJcblx0XHRcdG9wZW5Nb2RhbChuYW1lID0gJ9Ch0L7QvtCx0YnQtdC90LjQtScsIHRleHQgPSBvcmRlclJlc3BvbnNlLm1lc3NhZ2UpOzsgLy9zdGF0dXMgMSBzdWNjZXNzIHNlbmRcclxuXHRcdFx0b3JkZXJGb3JtLnJlc2V0KCk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRvcGVuTW9kYWwobmFtZSA9ICfQntGI0LjQsdC60LAnLCB0ZXh0ID0gb3JkZXJSZXNwb25zZS5tZXNzYWdlKTtcclxuXHRcdH07XHJcblx0fVxyXG59KTtcclxuXHJcbi8vIEJ1cmdlcnMgLSDRgdC60YDRi9GC0Ywu0L/QvtC60LDQt9Cw0YLRjCDQuNC90LPRgNC10LTQuNC10L3RgtGLXHJcbi8vIGxldCBpbmdyZWRpZW50c1Zpc2liaWxpdHkgPSAoKSA9PiB7XHJcbiQoXCIuaW5ncmVkaWVudHNcIikub24oe1xyXG5cdC8vIGNsaWNrOiBlID0+IHtcclxuXHQvLyBcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHQvLyBcdCQoZS5jdXJyZW50VGFyZ2V0KS50b2dnbGVDbGFzcygnaXMtYWN0aXZlJyk7XHJcblx0Ly8gfSxcclxuXHRtb3VzZWVudGVyOiBlID0+IHtcclxuXHRcdCQoZS5jdXJyZW50VGFyZ2V0KS50b2dnbGVDbGFzcygnaXMtYWN0aXZlJyk7XHJcblx0fSxcclxuXHRtb3VzZWxlYXZlOiBlID0+IHtcclxuXHRcdCQoZS5jdXJyZW50VGFyZ2V0KS5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7XHJcblx0fVxyXG59KVxyXG5cclxuLy8gfTsiLCIvLyDQodC60L7Qv9C40L/QsNGJ0LXQvdC+INGBINC+0YTQuNGG0LjQsNC70YzQvdC+0Lkg0LTQvtC60YPQvNC10L3RgtCw0YbQuNC4XHJcbmlmIChmYWxzZSkge1xyXG5cclxuXHR5bWFwcy5yZWFkeShmdW5jdGlvbiAoKSB7XHJcblx0XHR2YXIgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKCdtYXAnLCB7XHJcblx0XHRcdFx0Y2VudGVyOiBbNTkuOTMsIDMwLjMzXSxcclxuXHRcdFx0XHR6b29tOiAxMlxyXG5cdFx0XHR9LCB7XHJcblx0XHRcdFx0c2VhcmNoQ29udHJvbFByb3ZpZGVyOiAneWFuZGV4I3NlYXJjaCdcclxuXHRcdFx0fSksXHJcblx0XHRcdGNsdXN0ZXJlciA9IG5ldyB5bWFwcy5DbHVzdGVyZXIoe1xyXG5cdFx0XHRcdC8vINCX0LDQtNCw0LTQuNC8INC80LDRgdGB0LjQsiwg0L7Qv9C40YHRi9Cy0LDRjtGJ0LjQuSDQuNC60L7QvdC60Lgg0LrQu9Cw0YHRgtC10YDQvtCyINGA0LDQt9C90L7Qs9C+INGA0LDQt9C80LXRgNCwLlxyXG5cdFx0XHRcdGNsdXN0ZXJJY29uczogW3tcclxuXHRcdFx0XHRcdFx0aHJlZjogJy4uL2ltZy9jb250YWN0cy9tYXAtbWFya2VyLnBuZycsXHJcblx0XHRcdFx0XHRcdHNpemU6IFs0NiwgNThdLFxyXG5cdFx0XHRcdFx0XHRvZmZzZXQ6IFstMjMsIC0yOV1cclxuXHRcdFx0XHRcdH0sXHJcblx0XHRcdFx0XHR7XHJcblx0XHRcdFx0XHRcdGhyZWY6ICcuLi9pbWcvY29udGFjdHMvbWFwLW1hcmtlci5wbmcnLFxyXG5cdFx0XHRcdFx0XHRzaXplOiBbNDYsIDU4XSxcclxuXHRcdFx0XHRcdFx0b2Zmc2V0OiBbLTIzLCAtMjldXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XSxcclxuXHRcdFx0XHQvLyDQrdGC0LAg0L7Qv9GG0LjRjyDQvtGC0LLQtdGH0LDQtdGCINC30LAg0YDQsNC30LzQtdGA0Ysg0LrQu9Cw0YHRgtC10YDQvtCyLlxyXG5cdFx0XHRcdC8vINCSINC00LDQvdC90L7QvCDRgdC70YPRh9Cw0LUg0LTQu9GPINC60LvQsNGB0YLQtdGA0L7Qsiwg0YHQvtC00LXRgNC20LDRidC40YUg0LTQviAxMDAg0Y3Qu9C10LzQtdC90YLQvtCyLFxyXG5cdFx0XHRcdC8vINCx0YPQtNC10YIg0L/QvtC60LDQt9GL0LLQsNGC0YzRgdGPINC80LDQu9C10L3RjNC60LDRjyDQuNC60L7QvdC60LAuINCU0LvRjyDQvtGB0YLQsNC70YzQvdGL0YUgLSDQsdC+0LvRjNGI0LDRjy5cclxuXHRcdFx0XHRjbHVzdGVyTnVtYmVyczogWzhdLFxyXG5cdFx0XHRcdGNsdXN0ZXJJY29uQ29udGVudExheW91dDogbnVsbFxyXG5cdFx0XHR9KSxcclxuXHRcdFx0Z2V0UG9pbnREYXRhID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcblx0XHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRcdGJhbGxvb25Db250ZW50Qm9keTogJ9GC0L7RiNC90LjQu9C+0LLQutCwIDxzdHJvbmc+4oSWJyArIGluZGV4ICsgJzwvc3Ryb25nPicsXHJcblx0XHRcdFx0XHQvLyBjbHVzdGVyQ2FwdGlvbjogJ9C80LXRgtC60LAgPHN0cm9uZz4nICsgaW5kZXggKyAnPC9zdHJvbmc+JyxcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRwb2ludHMgPSBbXHJcblx0XHRcdFx0WzU5LjksIDMwLjNdLFxyXG5cdFx0XHRcdFs1OS45NSwgMzAuNDNdLFxyXG5cdFx0XHRcdFs1OS45NywgMzAuMzVdLFxyXG5cclxuXHRcdFx0XSxcclxuXHRcdFx0Z2VvT2JqZWN0cyA9IFtdO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0Z2VvT2JqZWN0c1tpXSA9IG5ldyB5bWFwcy5QbGFjZW1hcmsocG9pbnRzW2ldLCBnZXRQb2ludERhdGEoaSksIHtcclxuXHRcdFx0XHRpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZVdpdGhDb250ZW50JyxcclxuXHRcdFx0XHRpY29uSW1hZ2VIcmVmOiAnLi4vaW1nL2NvbnRhY3RzL21hcC1tYXJrZXIucG5nJyxcclxuXHRcdFx0XHRpY29uSW1hZ2VTaXplOiBbNDYsIDU4XSxcclxuXHRcdFx0XHRpY29uSW1hZ2VPZmZzZXQ6IFstMjMsIC0yOV1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Y2x1c3RlcmVyLmFkZChnZW9PYmplY3RzKTtcclxuXHRcdG15TWFwLmdlb09iamVjdHMuYWRkKGNsdXN0ZXJlcik7XHJcblxyXG5cdFx0bXlNYXAuc2V0Qm91bmRzKGNsdXN0ZXJlci5nZXRCb3VuZHMoKSwge1xyXG5cdFx0XHRjaGVja1pvb21SYW5nZTogdHJ1ZVxyXG5cdFx0fSk7XHJcblx0fSk7XHJcbn0iLCJ2YXIgaW5pdE9wcyA9ICgoKSA9PiB7XHJcblx0b3BzID0ge307XHJcblx0b3BzLm1vZGVsID0gKCgpID0+IHtcclxuXHRcdHZhciBjdXJyZW50UG9zaXRpb24gPSAwO1xyXG5cdFx0Y29uc3QgbWluUG9zaXRpb24gPSAwLFxyXG5cdFx0XHRtYXhQb3NpdGlvbiA9ICQoJy5zZWN0aW9uJykubGVuZ3RoIC0gMTtcclxuXHJcblx0XHRtb3ZlVG8gPSAoKG5ld1Bvc2l0aW9uKSA9PiB7XHJcblx0XHRcdGlzTGFzdFBvc2l0aW9uID0gKG5ld1Bvc2l0aW9uID09PSBtYXhQb3NpdGlvbik7XHJcblx0XHRcdGlmIChuZXdQb3NpdGlvbiAhPSBjdXJyZW50UG9zaXRpb24pIHtcclxuXHRcdFx0XHRvcHMudmlldy5nb1RvU2VjdGlvbihuZXdQb3NpdGlvbiwgaXNMYXN0UG9zaXRpb24pO1xyXG5cdFx0XHRcdGN1cnJlbnRQb3NpdGlvbiA9IG5ld1Bvc2l0aW9uO1xyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cdFx0bW92ZU9uID0gKChkZWx0YVkpID0+IHtcclxuXHRcdFx0bGV0IG5ld1Bvc2l0aW9uID0gTWF0aC5tYXgoXHJcblx0XHRcdFx0TWF0aC5taW4oKGN1cnJlbnRQb3NpdGlvbiArIGRlbHRhWSksIG1heFBvc2l0aW9uKSxcclxuXHRcdFx0XHRtaW5Qb3NpdGlvblxyXG5cdFx0XHQpXHJcblx0XHRcdG1vdmVUbyhuZXdQb3NpdGlvbik7XHJcblx0XHR9KVxyXG5cclxuXHRcdG1vdmVEb3duID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRjdXJyZW50UG9zaXRpb24gPCBtYXhQb3NpdGlvbiA/IG9wcy5tb2RlbC5tb3ZlT24oMSkgOiBvcHMubW9kZWwubW92ZVRvKDApO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0bW92ZVRvLFxyXG5cdFx0XHRtb3ZlT24sXHJcblx0XHRcdG1vdmVEb3duXHJcblx0XHR9XHJcblx0fSkoKVxyXG5cclxuXHRvcHMudmlldyA9ICgoKSA9PiB7XHJcblx0XHRvcHNDb250YWluZXIgPSAkKCcub3BzX19jb250YWluZXInKTtcclxuXHRcdGRvd25CdXR0b24gPSAkKCcuZG93bi1idG4nKTtcclxuXHRcdG9wc1NsaWRlckl0ZW1zID0gJCgnLm9wcy1zbGlkZXJfX2l0ZW0nKTtcclxuXHJcblx0XHRnb1RvU2VjdGlvbiA9ICgocG9zaXRpb24sIGlzTGFzdFBvc2l0aW9uID0gZmFsc2UpID0+IHtcclxuXHRcdFx0dHJhbnNsYXRlUHJvcGVyeSA9IGB0cmFuc2xhdGVZKCR7LXBvc2l0aW9uICogMTAwfXZoKWA7XHJcblx0XHRcdG9wc0NvbnRhaW5lci5jc3Moe1xyXG5cdFx0XHRcdHRyYW5zZm9ybTogdHJhbnNsYXRlUHJvcGVyeVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0b3BzU2xpZGVySXRlbXMucmVtb3ZlQ2xhc3MoJ2lzLWFjdGl2ZScpO1xyXG5cdFx0XHRvcHNTbGlkZXJJdGVtcy5lcShwb3NpdGlvbikuYWRkQ2xhc3MoJ2lzLWFjdGl2ZScpO1xyXG5cdFx0XHRpZiAoaXNMYXN0UG9zaXRpb24pIHtcclxuXHRcdFx0XHRkb3duQnV0dG9uLmNzcygndHJhbnNmb3JtJywgXCJyb3RhdGUoMTgwZGVnKVwiKVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGRvd25CdXR0b24uY3NzKCd0cmFuc2Zvcm0nLCBcInJvdGF0ZSgwZGVnKVwiKVxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0Z29Ub1NlY3Rpb25cclxuXHRcdH1cclxuXHR9KSgpO1xyXG5cclxuXHRvcHMuY29udHJvbGwgPSAoKCkgPT4ge1xyXG5cdFx0JCgnLm9wcycpLm9uKCd3aGVlbCcsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdG9wcy5tb2RlbC5tb3ZlT24oTWF0aC5mbG9vcihlLm9yaWdpbmFsRXZlbnQuZGVsdGFZIC8gMTAwKSk7XHJcblx0XHR9KTtcclxuXHRcdCQoJy5kb3duLWJ0bicpLm9uKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdG9wcy5tb2RlbC5tb3ZlRG93bigpO1xyXG5cdFx0fSk7XHJcblx0XHQkKCcub3BzLXNsaWRlciBsaScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0b3BzLm1vZGVsLm1vdmVUbygkKHRoaXMpLmluZGV4KCkpO1xyXG5cdFx0fSlcclxuXHRcdCQoZG9jdW1lbnQpLm9uKHtcclxuXHRcdFx0J2tleWRvd24nOiBlID0+IHtcclxuXHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG5cdFx0XHRcdFx0Y2FzZSA0MDpcclxuXHRcdFx0XHRcdFx0b3BzLm1vZGVsLm1vdmVPbigxKTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRjYXNlIDM4OlxyXG5cdFx0XHRcdFx0XHRvcHMubW9kZWwubW92ZU9uKC0xKTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cclxuXHR9KSgpXHJcbn0pO1xyXG5cclxuXHJcbmluaXRPcHMoKTtcclxuXHJcblxyXG5cclxuXHJcbi8vIHRvdWNobW92ZTogZSA9PiBlLlByZXZlbnREZWZhdWx0KCkiXX0=
